<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring AI RAG ì‹œìŠ¤í…œ êµ¬ì¶• ê°€ì´ë“œ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .code-block { background: #2d3748; border-radius: 8px; }
        .copy-button { transition: all 0.2s ease; }
        .copy-button:hover { background-color: #4a5568; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <a href="../index.html" class="flex items-center text-xl font-bold text-gray-800">
                        <i class="fab fa-spring text-green-600 mr-2"></i>
                        Spring AI Hub
                    </a>
                    <span class="mx-3 text-gray-400">/</span>
                    <span class="text-gray-600">RAG ì‹œìŠ¤í…œ ê°€ì´ë“œ</span>
                </div>
                <a href="../index.html" class="text-blue-600 hover:text-blue-800">
                    <i class="fas fa-home"></i> í™ˆìœ¼ë¡œ
                </a>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl font-bold mb-4">ğŸ” RAG ì‹œìŠ¤í…œ êµ¬ì¶• ê°€ì´ë“œ</h1>
            <p class="text-gray-600 mb-8">Retrieval-Augmented Generation ì‹œìŠ¤í…œì„ Spring AIë¡œ êµ¬í˜„í•˜ëŠ” ì™„ì „í•œ ê°€ì´ë“œ</p>

            <!-- Table of Contents -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
                <h2 class="text-xl font-semibold mb-4">ëª©ì°¨</h2>
                <ul class="space-y-2 text-blue-600">
                    <li><a href="#what-is-rag" class="hover:underline">1. RAGë€ ë¬´ì—‡ì¸ê°€?</a></li>
                    <li><a href="#architecture" class="hover:underline">2. RAG ì•„í‚¤í…ì²˜ ì„¤ê³„</a></li>
                    <li><a href="#implementation" class="hover:underline">3. ë‹¨ê³„ë³„ êµ¬í˜„</a></li>
                    <li><a href="#vector-store" class="hover:underline">4. ë²¡í„° ìŠ¤í† ì–´ ì„¤ì •</a></li>
                    <li><a href="#optimization" class="hover:underline">5. ê²€ìƒ‰ ìµœì í™”</a></li>
                    <li><a href="#production" class="hover:underline">6. í”„ë¡œë•ì…˜ ê³ ë ¤ì‚¬í•­</a></li>
                </ul>
            </div>

            <!-- Section 1: What is RAG -->
            <section id="what-is-rag" class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">1. RAGë€ ë¬´ì—‡ì¸ê°€?</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <p class="mb-4">
                        RAG (Retrieval-Augmented Generation)ëŠ” ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸(LLM)ì˜ í•œê³„ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•œ ê¸°ìˆ ë¡œ,
                        ì™¸ë¶€ ì§€ì‹ ë² ì´ìŠ¤ì—ì„œ ê´€ë ¨ ì •ë³´ë¥¼ ê²€ìƒ‰í•˜ì—¬ ë” ì •í™•í•˜ê³  ìµœì‹ ì˜ ë‹µë³€ì„ ìƒì„±í•©ë‹ˆë‹¤.
                    </p>
                    
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <h3 class="font-semibold mb-2">RAGì˜ ì¥ì :</h3>
                        <ul class="space-y-1">
                            <li>âœ… ìµœì‹  ì •ë³´ ì œê³µ ê°€ëŠ¥</li>
                            <li>âœ… ë„ë©”ì¸ íŠ¹í™” ì§€ì‹ í™œìš©</li>
                            <li>âœ… í™˜ê°(Hallucination) ê°ì†Œ</li>
                            <li>âœ… ì†ŒìŠ¤ ì¶”ì  ê°€ëŠ¥</li>
                        </ul>
                    </div>

                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 class="font-semibold mb-2">RAG í”„ë¡œì„¸ìŠ¤:</h3>
                        <pre class="text-sm font-mono">
1. ì‚¬ìš©ì ì§ˆë¬¸ ìˆ˜ì‹ 
    â†“
2. ì§ˆë¬¸ì„ ì„ë² ë”©ìœ¼ë¡œ ë³€í™˜
    â†“
3. ë²¡í„° DBì—ì„œ ìœ ì‚¬í•œ ë¬¸ì„œ ê²€ìƒ‰
    â†“
4. ê²€ìƒ‰ëœ ë¬¸ì„œë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ í¬í•¨
    â†“
5. LLMì´ ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ë‹µë³€ ìƒì„±
                        </pre>
                    </div>
                </div>
            </section>

            <!-- Section 2: Architecture -->
            <section id="architecture" class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">2. RAG ì•„í‚¤í…ì²˜ ì„¤ê³„</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ê¸°ë³¸ ì•„í‚¤í…ì²˜</h3>
                    
                    <div class="code-block p-4 relative mb-4">
                        <pre class="font-mono"><code class="language-text">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ì‚¬ìš©ì     â”‚â”€â”€â”€â”€â–¶â”‚  Spring Boot   â”‚â”€â”€â”€â”€â–¶â”‚    LLM      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  Application   â”‚     â”‚  (OpenAI)   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Vector Store   â”‚
                    â”‚  (PGVector)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        </code></pre>
                    </div>

                    <h3 class="text-lg font-semibold mb-3">ì»´í¬ë„ŒíŠ¸ ì„¤ëª…</h3>
                    <ul class="space-y-2">
                        <li><strong>Document Loader</strong>: PDF, Word, ì›¹í˜ì´ì§€ ë“± ë‹¤ì–‘í•œ ì†ŒìŠ¤ì—ì„œ ë¬¸ì„œ ë¡œë“œ</li>
                        <li><strong>Text Splitter</strong>: ë¬¸ì„œë¥¼ ì ì ˆí•œ í¬ê¸°ì˜ ì²­í¬ë¡œ ë¶„í• </li>
                        <li><strong>Embedding Model</strong>: í…ìŠ¤íŠ¸ë¥¼ ë²¡í„°ë¡œ ë³€í™˜</li>
                        <li><strong>Vector Store</strong>: ë²¡í„° ë°ì´í„° ì €ì¥ ë° ê²€ìƒ‰</li>
                        <li><strong>Retriever</strong>: ì§ˆë¬¸ê³¼ ê´€ë ¨ëœ ë¬¸ì„œ ê²€ìƒ‰</li>
                        <li><strong>LLM</strong>: ê²€ìƒ‰ëœ ë¬¸ì„œë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€ ìƒì„±</li>
                    </ul>
                </div>
            </section>

            <!-- Section 3: Implementation -->
            <section id="implementation" class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">3. ë‹¨ê³„ë³„ êµ¬í˜„</h2>
                
                <!-- Step 1: Dependencies -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">Step 1: ì˜ì¡´ì„± ì¶”ê°€</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('dependencies')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="dependencies"><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;
    &lt;artifactId&gt;spring-ai-openai-spring-boot-starter&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;
    &lt;artifactId&gt;spring-ai-pgvector-store-spring-boot-starter&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;
    &lt;artifactId&gt;spring-ai-pdf-document-reader&lt;/artifactId&gt;
&lt;/dependency&gt;</code></pre>
                    </div>
                </div>

                <!-- Step 2: Document Processing -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">Step 2: ë¬¸ì„œ ì²˜ë¦¬ ì„œë¹„ìŠ¤</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('document-service')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="document-service"><code class="language-java">@Service
@Slf4j
public class DocumentProcessingService {
    
    private final VectorStore vectorStore;
    private final DocumentReader documentReader;
    
    public DocumentProcessingService(VectorStore vectorStore) {
        this.vectorStore = vectorStore;
        this.documentReader = new PdfDocumentReader();
    }
    
    public void processDocument(Resource resource) {
        log.info("Processing document: {}", resource.getFilename());
        
        // 1. ë¬¸ì„œ ì½ê¸°
        List<Document> documents = documentReader.read(resource);
        
        // 2. í…ìŠ¤íŠ¸ ë¶„í•  (ì²­í¬ ìƒì„±)
        TextSplitter splitter = new TokenTextSplitter();
        List<Document> chunks = splitter.apply(documents);
        
        // 3. ë©”íƒ€ë°ì´í„° ì¶”ê°€
        chunks.forEach(chunk -> {
            chunk.getMetadata().put("source", resource.getFilename());
            chunk.getMetadata().put("processed_at", Instant.now().toString());
        });
        
        // 4. ë²¡í„° ìŠ¤í† ì–´ì— ì €ì¥
        vectorStore.add(chunks);
        
        log.info("Processed {} chunks from {}", chunks.size(), resource.getFilename());
    }
    
    // ë‹¤ì–‘í•œ ë¬¸ì„œ í˜•ì‹ ì§€ì›
    public void processMultipleFormats(MultipartFile file) {
        String contentType = file.getContentType();
        
        DocumentReader reader = switch (contentType) {
            case "application/pdf" -> new PdfDocumentReader();
            case "text/plain" -> new TextDocumentReader();
            case "text/markdown" -> new MarkdownDocumentReader();
            default -> throw new UnsupportedDocumentException(contentType);
        };
        
        List<Document> documents = reader.read(file.getResource());
        processDocuments(documents);
    }
}</code></pre>
                    </div>
                </div>

                <!-- Step 3: RAG Service -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">Step 3: RAG ì„œë¹„ìŠ¤ êµ¬í˜„</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('rag-service')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="rag-service"><code class="language-java">@Service
@Slf4j
public class RAGService {
    
    private final ChatClient chatClient;
    private final VectorStore vectorStore;
    
    public RAGService(ChatClient.Builder chatClientBuilder, VectorStore vectorStore) {
        this.chatClient = chatClientBuilder
            .defaultOptions(OpenAiChatOptions.builder()
                .withModel(OpenAiApi.ChatModel.GPT_4_O)
                .withTemperature(0.7f)
                .build())
            .build();
        this.vectorStore = vectorStore;
    }
    
    public String askQuestion(String question) {
        return askQuestion(question, 5, 0.7);
    }
    
    public String askQuestion(String question, int topK, double threshold) {
        log.debug("Processing question: {}", question);
        
        // 1. ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰
        List<Document> relevantDocuments = vectorStore.similaritySearch(
            SearchRequest.query(question)
                .withTopK(topK)
                .withSimilarityThreshold(threshold)
        );
        
        if (relevantDocuments.isEmpty()) {
            log.warn("No relevant documents found for: {}", question);
            return "ê´€ë ¨ ë¬¸ì„œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
        }
        
        // 2. ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±
        String context = relevantDocuments.stream()
            .map(Document::getContent)
            .collect(Collectors.joining("\n\n"));
        
        // 3. í”„ë¡¬í”„íŠ¸ êµ¬ì„± ë° ì‘ë‹µ ìƒì„±
        return chatClient.prompt()
            .system("""
                ë‹¹ì‹ ì€ ì£¼ì–´ì§„ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì •í™•í•œ ë‹µë³€ì„ ì œê³µí•˜ëŠ” AI ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.
                ì»¨í…ìŠ¤íŠ¸ì— ì—†ëŠ” ì •ë³´ëŠ” ì¶”ì¸¡í•˜ì§€ ë§ˆì„¸ìš”.
                ë‹µë³€ ì‹œ ì¶œì²˜ë¥¼ ëª…ì‹œí•´ì£¼ì„¸ìš”.
                """)
            .user(u -> u.text("""
                ì»¨í…ìŠ¤íŠ¸:
                {context}
                
                ì§ˆë¬¸: {question}
                
                ìœ„ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì§ˆë¬¸ì— ë‹µë³€í•´ì£¼ì„¸ìš”.
                """)
                .param("context", context)
                .param("question", question))
            .call()
            .content();
    }
    
    // ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ
    public Flux<String> askQuestionStream(String question) {
        List<Document> relevantDocuments = vectorStore.similaritySearch(
            SearchRequest.query(question).withTopK(5)
        );
        
        String context = relevantDocuments.stream()
            .map(Document::getContent)
            .collect(Collectors.joining("\n\n"));
        
        return chatClient.prompt()
            .system("ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ë‹µë³€ ì œê³µ")
            .user(u -> u.text("ì»¨í…ìŠ¤íŠ¸: {context}\n\nì§ˆë¬¸: {question}")
                .param("context", context)
                .param("question", question))
            .stream()
            .content();
    }
    
    // ì¶œì²˜ í¬í•¨ ì‘ë‹µ
    public AnswerWithSources askQuestionWithSources(String question) {
        List<Document> relevantDocuments = vectorStore.similaritySearch(
            SearchRequest.query(question).withTopK(5)
        );
        
        Map<String, List<String>> sourceMap = relevantDocuments.stream()
            .collect(Collectors.groupingBy(
                doc -> doc.getMetadata().getOrDefault("source", "Unknown").toString(),
                Collectors.mapping(Document::getContent, Collectors.toList())
            ));
        
        String context = relevantDocuments.stream()
            .map(Document::getContent)
            .collect(Collectors.joining("\n\n"));
        
        String answer = chatClient.prompt()
            .user(u -> u.text("ì»¨í…ìŠ¤íŠ¸: {context}\n\nì§ˆë¬¸: {question}")
                .param("context", context)
                .param("question", question))
            .call()
            .content();
        
        return new AnswerWithSources(answer, sourceMap.keySet());
    }
}</code></pre>
                    </div>
                </div>

                <!-- Step 4: Controller -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">Step 4: REST API ì»¨íŠ¸ë¡¤ëŸ¬</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('rag-controller')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="rag-controller"><code class="language-java">@RestController
@RequestMapping("/api/rag")
@CrossOrigin(origins = "*")
public class RAGController {
    
    private final RAGService ragService;
    private final DocumentProcessingService documentService;
    
    @PostMapping("/documents/upload")
    public ResponseEntity<UploadResponse> uploadDocument(@RequestParam("file") MultipartFile file) {
        try {
            documentService.processDocument(file.getResource());
            return ResponseEntity.ok(new UploadResponse(
                "success", 
                "Document processed successfully"
            ));
        } catch (Exception e) {
            return ResponseEntity.badRequest().body(new UploadResponse(
                "error", 
                e.getMessage()
            ));
        }
    }
    
    @PostMapping("/ask")
    public ResponseEntity<AnswerResponse> askQuestion(@RequestBody QuestionRequest request) {
        String answer = ragService.askQuestion(request.getQuestion());
        return ResponseEntity.ok(new AnswerResponse(answer));
    }
    
    @PostMapping(value = "/ask/stream", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
    public Flux<ServerSentEvent<String>> askQuestionStream(@RequestBody QuestionRequest request) {
        return ragService.askQuestionStream(request.getQuestion())
            .map(content -> ServerSentEvent.<String>builder()
                .data(content)
                .build());
    }
    
    @PostMapping("/ask/sources")
    public ResponseEntity<AnswerWithSources> askWithSources(@RequestBody QuestionRequest request) {
        return ResponseEntity.ok(ragService.askQuestionWithSources(request.getQuestion()));
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Section 4: Vector Store -->
            <section id="vector-store" class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">4. ë²¡í„° ìŠ¤í† ì–´ ì„¤ì •</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">PostgreSQL + PGVector</h3>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('pgvector-config')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="pgvector-config"><code class="language-yaml">spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/ragdb
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
  
  ai:
    vectorstore:
      pgvector:
        index-type: HNSW
        distance-type: COSINE_DISTANCE
        dimensions: 1536
        # HNSW ì¸ë±ìŠ¤ ì„¤ì •
        initialization-timeout: 60s
        create-extension: true</code></pre>
                    </div>

                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <h4 class="font-semibold mb-2">PGVector ì„¤ì¹˜ (Docker)</h4>
                        <div class="code-block p-3">
                            <pre><code class="language-bash">docker run -d \
  --name pgvector \
  -e POSTGRES_PASSWORD=password \
  -e POSTGRES_DB=ragdb \
  -p 5432:5432 \
  ankane/pgvector</code></pre>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold mb-3 mt-6">ë‹¤ë¥¸ ë²¡í„° ìŠ¤í† ì–´ ì˜µì…˜</h3>
                    
                    <div class="grid gap-4">
                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold">Chroma (ë¡œì»¬ ê°œë°œ)</h4>
                            <div class="code-block p-3 mt-2">
                                <pre><code class="language-yaml">spring:
  ai:
    vectorstore:
      chroma:
        host: localhost
        port: 8000</code></pre>
                            </div>
                        </div>

                        <div class="border rounded-lg p-4">
                            <h4 class="font-semibold">Pinecone (í´ë¼ìš°ë“œ)</h4>
                            <div class="code-block p-3 mt-2">
                                <pre><code class="language-yaml">spring:
  ai:
    vectorstore:
      pinecone:
        api-key: ${PINECONE_API_KEY}
        environment: ${PINECONE_ENV}
        index-name: spring-ai-index</code></pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Section 5: Optimization -->
            <section id="optimization" class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">5. ê²€ìƒ‰ ìµœì í™”</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ êµ¬í˜„</h3>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('hybrid-search')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="hybrid-search"><code class="language-java">@Service
public class HybridSearchService {
    
    private final VectorStore vectorStore;
    private final FullTextSearchService fullTextSearch;
    
    public List<Document> hybridSearch(String query, float vectorWeight, float keywordWeight) {
        // 1. ë²¡í„° ê²€ìƒ‰
        List<Document> vectorResults = vectorStore.similaritySearch(
            SearchRequest.query(query).withTopK(20)
        );
        
        // 2. í‚¤ì›Œë“œ ê²€ìƒ‰
        List<Document> keywordResults = fullTextSearch.search(query);
        
        // 3. ê²°ê³¼ ë³‘í•© ë° ì¬ìˆœìœ„í™”
        Map<String, Double> scoreMap = new HashMap<>();
        
        // ë²¡í„° ê²€ìƒ‰ ì ìˆ˜
        for (int i = 0; i < vectorResults.size(); i++) {
            Document doc = vectorResults.get(i);
            double score = (1.0 - i * 0.05) * vectorWeight;
            scoreMap.put(doc.getId(), score);
        }
        
        // í‚¤ì›Œë“œ ê²€ìƒ‰ ì ìˆ˜ ì¶”ê°€
        for (int i = 0; i < keywordResults.size(); i++) {
            Document doc = keywordResults.get(i);
            double score = (1.0 - i * 0.05) * keywordWeight;
            scoreMap.merge(doc.getId(), score, Double::sum);
        }
        
        // ìµœì¢… ì •ë ¬
        return scoreMap.entrySet().stream()
            .sorted(Map.Entry.<String, Double>comparingByValue().reversed())
            .limit(10)
            .map(entry -> findDocumentById(entry.getKey()))
            .collect(Collectors.toList());
    }
}</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold mb-3">ì²­í¬ ìµœì í™”</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('chunk-optimization')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="chunk-optimization"><code class="language-java">@Configuration
public class ChunkingConfiguration {
    
    @Bean
    public TextSplitter textSplitter() {
        return new TokenTextSplitter(
            512,    // ì²­í¬ í¬ê¸°
            100,    // ì˜¤ë²„ë©
            true    // ë¬¸ì¥ ê²½ê³„ ìœ ì§€
        );
    }
    
    // ì»¤ìŠ¤í…€ ì²­í¬ ì „ëµ
    public List<Document> smartChunking(String text) {
        List<Document> chunks = new ArrayList<>();
        
        // 1. ì„¹ì…˜ë³„ ë¶„í• 
        String[] sections = text.split("\\n\\n#+\\s");
        
        for (String section : sections) {
            // 2. ê° ì„¹ì…˜ì„ ì ì ˆí•œ í¬ê¸°ë¡œ ë¶„í• 
            if (section.length() > 1000) {
                // ê¸´ ì„¹ì…˜ì€ ì¶”ê°€ ë¶„í• 
                List<String> subChunks = splitByParagraph(section, 500);
                for (String chunk : subChunks) {
                    chunks.add(new Document(chunk));
                }
            } else {
                chunks.add(new Document(section));
            }
        }
        
        return chunks;
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Section 6: Production -->
            <section id="production" class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">6. í”„ë¡œë•ì…˜ ê³ ë ¤ì‚¬í•­</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</h3>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('monitoring')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="monitoring"><code class="language-java">@Component
public class RAGMetrics {
    
    private final MeterRegistry meterRegistry;
    
    public void recordSearchLatency(long duration) {
        meterRegistry.timer("rag.search.latency").record(duration, TimeUnit.MILLISECONDS);
    }
    
    public void recordDocumentCount(int count) {
        meterRegistry.gauge("rag.documents.retrieved", count);
    }
    
    public void recordRelevanceScore(double score) {
        meterRegistry.summary("rag.relevance.score").record(score);
    }
}

@Aspect
@Component
public class RAGMonitoringAspect {
    
    private final RAGMetrics metrics;
    
    @Around("@annotation(MonitorRAG)")
    public Object monitorRAGOperation(ProceedingJoinPoint joinPoint) throws Throwable {
        long start = System.currentTimeMillis();
        
        try {
            Object result = joinPoint.proceed();
            
            if (result instanceof List<?> documents) {
                metrics.recordDocumentCount(documents.size());
            }
            
            return result;
        } finally {
            metrics.recordSearchLatency(System.currentTimeMillis() - start);
        }
    }
}</code></pre>
                    </div>

                    <h3 class="text-lg font-semibold mb-3">ë³´ì•ˆ ê³ ë ¤ì‚¬í•­</h3>
                    
                    <ul class="space-y-2 mb-4">
                        <li>âœ… ë¬¸ì„œ ì ‘ê·¼ ê¶Œí•œ ê´€ë¦¬</li>
                        <li>âœ… PII ë°ì´í„° í•„í„°ë§</li>
                        <li>âœ… ì§ˆì˜ ë¡œê¹… ë° ê°ì‚¬</li>
                        <li>âœ… Rate limiting ì ìš©</li>
                    </ul>

                    <h3 class="text-lg font-semibold mb-3">í™•ì¥ì„±</h3>
                    
                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">ëŒ€ê·œëª¨ ë¬¸ì„œ ì²˜ë¦¬ë¥¼ ìœ„í•œ íŒ:</h4>
                        <ul class="space-y-1 text-sm">
                            <li>â€¢ ë°°ì¹˜ ì²˜ë¦¬ë¡œ ë¬¸ì„œ ì„ë² ë”©</li>
                            <li>â€¢ ë²¡í„° ì¸ë±ìŠ¤ ìµœì í™” (HNSW, IVF)</li>
                            <li>â€¢ ìºì‹± ì „ëµ ì ìš©</li>
                            <li>â€¢ ë¹„ë™ê¸° ì²˜ë¦¬ í™œìš©</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Best Practices -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">ğŸ¯ Best Practices</h2>
                
                <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">RAG ì‹œìŠ¤í…œ êµ¬ì¶• ì‹œ ê¶Œì¥ì‚¬í•­</h3>
                    
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold mb-2">ë¬¸ì„œ ì²˜ë¦¬</h4>
                            <ul class="space-y-1 text-sm">
                                <li>â€¢ ì ì ˆí•œ ì²­í¬ í¬ê¸° ì„ íƒ (300-800 í† í°)</li>
                                <li>â€¢ ì˜ë¯¸ ìˆëŠ” ë©”íƒ€ë°ì´í„° ì¶”ê°€</li>
                                <li>â€¢ ì¤‘ë³µ ë¬¸ì„œ ì œê±°</li>
                                <li>â€¢ ì •ê¸°ì ì¸ ì¬ì¸ë±ì‹±</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold mb-2">ê²€ìƒ‰ ìµœì í™”</h4>
                            <ul class="space-y-1 text-sm">
                                <li>â€¢ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ í™œìš©</li>
                                <li>â€¢ ë™ì  ì„ê³„ê°’ ì¡°ì •</li>
                                <li>â€¢ ì¿¼ë¦¬ í™•ì¥ ê¸°ë²• ì ìš©</li>
                                <li>â€¢ ê²°ê³¼ ì¬ìˆœìœ„í™”</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Next Steps -->
            <section class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-xl font-semibold mb-4">ë‹¤ìŒ ë‹¨ê³„</h2>
                
                <div class="grid md:grid-cols-3 gap-4">
                    <a href="tools.html" class="block p-4 border rounded-lg hover:bg-gray-50 transition">
                        <h3 class="font-semibold text-blue-600 mb-2">Tool Calling ì¶”ê°€</h3>
                        <p class="text-sm text-gray-600">RAGì— í•¨ìˆ˜ í˜¸ì¶œ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì—¬ ë” ê°•ë ¥í•œ ì‹œìŠ¤í…œ êµ¬ì¶•</p>
                    </a>
                    
                    <a href="agents.html" class="block p-4 border rounded-lg hover:bg-gray-50 transition">
                        <h3 class="font-semibold text-green-600 mb-2">ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ</h3>
                        <p class="text-sm text-gray-600">RAGë¥¼ í™œìš©í•œ ììœ¨ ì—ì´ì „íŠ¸ êµ¬í˜„</p>
                    </a>
                    
                    <a href="vectorstore.html" class="block p-4 border rounded-lg hover:bg-gray-50 transition">
                        <h3 class="font-semibold text-purple-600 mb-2">ë²¡í„° ìŠ¤í† ì–´ ì‹¬í™”</h3>
                        <p class="text-sm text-gray-600">ë‹¤ì–‘í•œ ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ ë¹„êµ ë° ìµœì í™”</p>
                    </a>
                </div>
            </section>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
        function copyCode(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showNotification('ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg z-50';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 2000);
        }
    </script>
</body>
</html>