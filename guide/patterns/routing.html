<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Routing íŒ¨í„´ - Spring AI</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .code-block { background: #2d3748; border-radius: 8px; }
        .copy-button { transition: all 0.2s ease; }
        .copy-button:hover { background-color: #4a5568; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <a href="../../index.html" class="flex items-center text-xl font-bold text-gray-800">
                        <i class="fab fa-spring text-green-600 mr-2"></i>
                        Spring AI Hub
                    </a>
                    <span class="mx-3 text-gray-400">/</span>
                    <a href="../patterns.html" class="text-gray-600 hover:text-gray-800">íŒ¨í„´ ê°€ì´ë“œ</a>
                    <span class="mx-3 text-gray-400">/</span>
                    <span class="text-gray-600">Smart Routing</span>
                </div>
                <a href="../../index.html" class="text-blue-600 hover:text-blue-800">
                    <i class="fas fa-home"></i> í™ˆìœ¼ë¡œ
                </a>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl font-bold mb-4">ğŸš¦ Smart Routing íŒ¨í„´</h1>
            <p class="text-gray-600 mb-8">ìš”ì²­ ë‚´ìš©ì— ë”°ë¼ ìµœì ì˜ AI ëª¨ë¸ì´ë‚˜ ì—ì´ì „íŠ¸ë¡œ ë¼ìš°íŒ…í•˜ëŠ” ì§€ëŠ¥í˜• íŒ¨í„´</p>

            <!-- Overview -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">ê°œìš”</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <p class="mb-4">
                        Smart Routing íŒ¨í„´ì€ ì…ë ¥ ìš”ì²­ì˜ íŠ¹ì„±ì„ ë¶„ì„í•˜ì—¬ ê°€ì¥ ì í•©í•œ ì²˜ë¦¬ ê²½ë¡œë¡œ ìë™ ë¼ìš°íŒ…í•˜ëŠ” íŒ¨í„´ì…ë‹ˆë‹¤. 
                        ê° ëª¨ë¸ì´ë‚˜ ì—ì´ì „íŠ¸ì˜ ê°•ì ì„ í™œìš©í•˜ì—¬ ìµœì ì˜ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                    
                    <div class="bg-purple-50 p-4 rounded-lg mb-4">
                        <h3 class="font-semibold mb-2">ì£¼ìš” íŠ¹ì§•:</h3>
                        <ul class="space-y-1">
                            <li>âœ… ìš”ì²­ ìœ í˜•ë³„ ìµœì  ëª¨ë¸ ìë™ ì„ íƒ</li>
                            <li>âœ… ë¹„ìš© ë° ì„±ëŠ¥ ìµœì í™”</li>
                            <li>âœ… ë™ì  ë¼ìš°íŒ… ê·œì¹™ ì—…ë°ì´íŠ¸</li>
                            <li>âœ… í´ë°± ë©”ì»¤ë‹ˆì¦˜ìœ¼ë¡œ ì•ˆì •ì„± ë³´ì¥</li>
                            <li>âœ… A/B í…ŒìŠ¤íŠ¸ ë° ì„±ëŠ¥ ì¶”ì </li>
                        </ul>
                    </div>

                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 class="font-semibold mb-2">ë¼ìš°íŒ… í”Œë¡œìš°:</h3>
                        <pre class="text-sm font-mono">
     ìš”ì²­ ì…ë ¥
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ ë¶„ë¥˜ê¸°  â”‚ â† ìš”ì²­ ìœ í˜• ë¶„ì„
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
    â”‚ ë¼ìš°í„°  â”‚ â† ìµœì  ê²½ë¡œ ê²°ì •
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼        â–¼        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Model Aâ”‚ â”‚ Model Bâ”‚ â”‚ Agent Câ”‚ â”‚ Agent Dâ”‚
â”‚ (ë¹ ë¦„) â”‚ â”‚ (ì •í™•) â”‚ â”‚ (ì „ë¬¸) â”‚ â”‚ (ì°½ì˜) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚         â”‚        â”‚        â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
    ê²°ê³¼ ë°˜í™˜
                        </pre>
                    </div>
                </div>
            </section>

            <!-- Basic Implementation -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">ê¸°ë³¸ êµ¬í˜„</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ìŠ¤ë§ˆíŠ¸ ë¼ìš°í„° êµ¬í˜„</h3>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('smart-router')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="smart-router"><code class="language-java">@Service
@Slf4j
public class SmartRouter {
    
    private final RequestClassifier classifier;
    private final Map<RequestType, ModelHandler> handlers;
    private final RoutingMetrics metrics;
    
    public SmartRouter() {
        this.handlers = initializeHandlers();
        this.classifier = new MLRequestClassifier();
        this.metrics = new RoutingMetrics();
    }
    
    public RouterResponse route(RouterRequest request) {
        // 1. ìš”ì²­ ë¶„ë¥˜
        RequestClassification classification = classifier.classify(request);
        log.info("Request classified as: {} with confidence: {}", 
            classification.getType(), classification.getConfidence());
        
        // 2. ìµœì  í•¸ë“¤ëŸ¬ ì„ íƒ
        ModelHandler handler = selectHandler(classification);
        
        // 3. ë©”íŠ¸ë¦­ ê¸°ë¡
        metrics.recordRouting(classification, handler.getName());
        
        // 4. ìš”ì²­ ì²˜ë¦¬
        try {
            return handler.handle(request);
        } catch (Exception e) {
            // 5. í´ë°± ì²˜ë¦¬
            return handleWithFallback(request, classification, e);
        }
    }
    
    private ModelHandler selectHandler(RequestClassification classification) {
        RequestType type = classification.getType();
        
        // ì‹ ë¢°ë„ê°€ ë‚®ìœ¼ë©´ ë²”ìš© ëª¨ë¸ ì‚¬ìš©
        if (classification.getConfidence() < 0.7) {
            return handlers.get(RequestType.GENERAL);
        }
        
        // ìœ í˜•ë³„ ìµœì  í•¸ë“¤ëŸ¬ ë°˜í™˜
        return handlers.getOrDefault(type, handlers.get(RequestType.GENERAL));
    }
    
    private Map<RequestType, ModelHandler> initializeHandlers() {
        return Map.of(
            RequestType.SIMPLE_QUERY, new FastModelHandler(),      // GPT-4o-mini
            RequestType.COMPLEX_ANALYSIS, new PowerfulModelHandler(), // GPT-4o
            RequestType.CREATIVE_TASK, new CreativeModelHandler(),   // Claude
            RequestType.CODE_GENERATION, new CodeModelHandler(),     // CodeLlama
            RequestType.TRANSLATION, new TranslationModelHandler(),  // ì „ë¬¸ ë²ˆì—­ ëª¨ë¸
            RequestType.GENERAL, new GeneralModelHandler()          // ë²”ìš© ëª¨ë¸
        );
    }
}

// ìš”ì²­ ë¶„ë¥˜ê¸°
@Component
public class MLRequestClassifier implements RequestClassifier {
    
    private final ChatClient classifierClient;
    private final FeatureExtractor featureExtractor;
    
    @Override
    public RequestClassification classify(RouterRequest request) {
        // íŠ¹ì§• ì¶”ì¶œ
        RequestFeatures features = featureExtractor.extract(request);
        
        // ê·œì¹™ ê¸°ë°˜ ë¹ ë¥¸ ë¶„ë¥˜
        RequestType quickType = quickClassify(features);
        if (quickType != null) {
            return new RequestClassification(quickType, 0.95);
        }
        
        // AI ê¸°ë°˜ ì •ë°€ ë¶„ë¥˜
        String classification = classifierClient.prompt()
            .system("""
                ìš”ì²­ì„ ë‹¤ìŒ ì¹´í…Œê³ ë¦¬ ì¤‘ í•˜ë‚˜ë¡œ ë¶„ë¥˜í•˜ì„¸ìš”:
                - SIMPLE_QUERY: ê°„ë‹¨í•œ ì§ˆë¬¸ì´ë‚˜ ì •ë³´ ìš”ì²­
                - COMPLEX_ANALYSIS: ë³µì¡í•œ ë¶„ì„ì´ë‚˜ ì¶”ë¡  í•„ìš”
                - CREATIVE_TASK: ì°½ì‘ì´ë‚˜ ì•„ì´ë””ì–´ ìƒì„±
                - CODE_GENERATION: ì½”ë“œ ì‘ì„±ì´ë‚˜ í”„ë¡œê·¸ë˜ë°
                - TRANSLATION: ë²ˆì—­ ì‘ì—…
                - GENERAL: ê¸°íƒ€ ì¼ë°˜ì ì¸ ì‘ì—…
                
                ì‘ë‹µ í˜•ì‹: {type: "...", confidence: 0.XX}
                """)
            .user(request.getContent())
            .call()
            .content();
        
        return parseClassification(classification);
    }
    
    private RequestType quickClassify(RequestFeatures features) {
        // ëª…í™•í•œ íŒ¨í„´ ë¹ ë¥¸ ë¶„ë¥˜
        if (features.containsCodeKeywords()) {
            return RequestType.CODE_GENERATION;
        }
        if (features.isTranslationRequest()) {
            return RequestType.TRANSLATION;
        }
        if (features.getWordCount() < 20 && features.isQuestion()) {
            return RequestType.SIMPLE_QUERY;
        }
        return null;
    }
}</code></pre>
                    </div>
                </div>

                <!-- Dynamic Routing Rules -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ë™ì  ë¼ìš°íŒ… ê·œì¹™</h3>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('dynamic-routing')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="dynamic-routing"><code class="language-java">@Service
public class DynamicRoutingEngine {
    
    private final RoutingRuleRepository ruleRepository;
    private final PerformanceAnalyzer performanceAnalyzer;
    private final LoadingCache<String, CompiledRule> ruleCache;
    
    public DynamicRoutingEngine() {
        this.ruleCache = Caffeine.newBuilder()
            .maximumSize(100)
            .expireAfterWrite(5, TimeUnit.MINUTES)
            .build(this::compileRule);
    }
    
    public RoutingDecision makeDecision(RouterRequest request) {
        // í™œì„± ê·œì¹™ ë¡œë“œ
        List<RoutingRule> activeRules = ruleRepository.findActiveRules();
        
        // ê·œì¹™ í‰ê°€
        for (RoutingRule rule : activeRules) {
            if (evaluateRule(rule, request)) {
                return RoutingDecision.builder()
                    .targetHandler(rule.getTargetHandler())
                    .rule(rule)
                    .confidence(rule.getConfidence())
                    .reason(rule.getDescription())
                    .build();
            }
        }
        
        // ê¸°ë³¸ ë¼ìš°íŒ…
        return defaultRouting(request);
    }
    
    private boolean evaluateRule(RoutingRule rule, RouterRequest request) {
        try {
            CompiledRule compiled = ruleCache.get(rule.getId());
            return compiled.evaluate(request);
        } catch (Exception e) {
            log.error("Rule evaluation failed: {}", rule.getId(), e);
            return false;
        }
    }
    
    // ì„±ëŠ¥ ê¸°ë°˜ ê·œì¹™ ìë™ ì¡°ì •
    @Scheduled(fixedDelay = 300000) // 5ë¶„ë§ˆë‹¤
    public void optimizeRules() {
        Map<String, PerformanceStats> stats = performanceAnalyzer.getStats();
        
        for (RoutingRule rule : ruleRepository.findAll()) {
            PerformanceStats perf = stats.get(rule.getId());
            
            if (perf != null) {
                // ì„±ëŠ¥ì´ ì¢‹ì€ ê·œì¹™ì€ ì‹ ë¢°ë„ ì¦ê°€
                if (perf.getSuccessRate() > 0.9 && perf.getAvgLatency() < 1000) {
                    rule.setConfidence(Math.min(1.0, rule.getConfidence() + 0.05));
                }
                // ì„±ëŠ¥ì´ ë‚˜ìœ ê·œì¹™ì€ ì‹ ë¢°ë„ ê°ì†Œ
                else if (perf.getSuccessRate() < 0.7 || perf.getAvgLatency() > 5000) {
                    rule.setConfidence(Math.max(0.1, rule.getConfidence() - 0.1));
                }
                
                ruleRepository.save(rule);
            }
        }
    }
}

// ì¡°ê±´ë¶€ ë¼ìš°íŒ…
@Component
public class ConditionalRouter {
    
    public RouterResponse routeWithConditions(RouterRequest request) {
        // ë¹„ì¦ˆë‹ˆìŠ¤ ì¡°ê±´ í™•ì¸
        if (isVIPCustomer(request.getUserId())) {
            return routeToPremiumModel(request);
        }
        
        // ì‹œê°„ëŒ€ë³„ ë¼ìš°íŒ…
        if (isPeakHour()) {
            return routeToFastModel(request);
        }
        
        // ë¹„ìš© ê¸°ë°˜ ë¼ìš°íŒ…
        if (request.getBudget() < 0.01) {
            return routeToEconomicModel(request);
        }
        
        // ì½˜í…ì¸  ê¸°ë°˜ ë¼ìš°íŒ…
        ContentAnalysis analysis = analyzeContent(request);
        
        if (analysis.requiresExpertise()) {
            return routeToExpertModel(request, analysis.getDomain());
        }
        
        if (analysis.isMultilingual()) {
            return routeToMultilingualModel(request);
        }
        
        // ê¸°ë³¸ ë¼ìš°íŒ…
        return routeToDefaultModel(request);
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Advanced Patterns -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">ê³ ê¸‰ íŒ¨í„´</h2>
                
                <!-- Load Balancing -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ë¡œë“œ ë°¸ëŸ°ì‹± ë¼ìš°íŒ…</h3>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('load-balancing')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="load-balancing"><code class="language-java">@Service
public class LoadBalancingRouter {
    
    private final Map<String, ModelEndpoint> endpoints;
    private final LoadBalancer loadBalancer;
    private final HealthChecker healthChecker;
    
    public LoadBalancingRouter() {
        this.endpoints = initializeEndpoints();
        this.loadBalancer = new WeightedRoundRobinBalancer();
        this.healthChecker = new HealthChecker();
    }
    
    public RouterResponse routeWithLoadBalancing(RouterRequest request) {
        RequestType type = classifyRequest(request);
        List<ModelEndpoint> availableEndpoints = getHealthyEndpoints(type);
        
        if (availableEndpoints.isEmpty()) {
            throw new NoAvailableEndpointException(
                "No healthy endpoints for type: " + type
            );
        }
        
        // ë¡œë“œ ë°¸ëŸ°ì‹± ì•Œê³ ë¦¬ì¦˜ìœ¼ë¡œ ì—”ë“œí¬ì¸íŠ¸ ì„ íƒ
        ModelEndpoint selected = loadBalancer.select(
            availableEndpoints, 
            request
        );
        
        // ìš”ì²­ ì²˜ë¦¬
        return processWithEndpoint(request, selected);
    }
    
    private List<ModelEndpoint> getHealthyEndpoints(RequestType type) {
        return endpoints.values().stream()
            .filter(ep -> ep.supportsType(type))
            .filter(healthChecker::isHealthy)
            .sorted(Comparator.comparing(ModelEndpoint::getCurrentLoad))
            .toList();
    }
    
    // ê°€ì¤‘ì¹˜ ê¸°ë°˜ ë¼ìš´ë“œ ë¡œë¹ˆ
    public static class WeightedRoundRobinBalancer implements LoadBalancer {
        
        private final Map<String, AtomicInteger> counters = new ConcurrentHashMap<>();
        
        @Override
        public ModelEndpoint select(List<ModelEndpoint> endpoints, RouterRequest request) {
            // ê°€ì¤‘ì¹˜ ê³„ì‚°
            Map<ModelEndpoint, Double> weights = calculateWeights(endpoints, request);
            
            // ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì„ íƒ
            double totalWeight = weights.values().stream()
                .mapToDouble(Double::doubleValue)
                .sum();
            
            double random = Math.random() * totalWeight;
            double cumulative = 0;
            
            for (Map.Entry<ModelEndpoint, Double> entry : weights.entrySet()) {
                cumulative += entry.getValue();
                if (random <= cumulative) {
                    return entry.getKey();
                }
            }
            
            return endpoints.get(0); // í´ë°±
        }
        
        private Map<ModelEndpoint, Double> calculateWeights(
                List<ModelEndpoint> endpoints, 
                RouterRequest request) {
            
            Map<ModelEndpoint, Double> weights = new HashMap<>();
            
            for (ModelEndpoint endpoint : endpoints) {
                double weight = 1.0;
                
                // ì„±ëŠ¥ ê°€ì¤‘ì¹˜
                weight *= (1.0 / (endpoint.getAvgLatency() / 1000.0 + 1));
                
                // ë¶€í•˜ ê°€ì¤‘ì¹˜
                weight *= (1.0 - endpoint.getCurrentLoad() / 100.0);
                
                // ë¹„ìš© ê°€ì¤‘ì¹˜
                if (request.isCostSensitive()) {
                    weight *= (1.0 / (endpoint.getCostPerRequest() + 1));
                }
                
                // ì„±ê³µë¥  ê°€ì¤‘ì¹˜
                weight *= endpoint.getSuccessRate();
                
                weights.put(endpoint, weight);
            }
            
            return weights;
        }
    }
}</code></pre>
                    </div>
                </div>

                <!-- A/B Testing Router -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">A/B í…ŒìŠ¤íŠ¸ ë¼ìš°í„°</h3>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('ab-testing')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="ab-testing"><code class="language-java">@Service
public class ABTestingRouter {
    
    private final ExperimentService experimentService;
    private final MetricsCollector metricsCollector;
    
    public RouterResponse routeWithABTest(RouterRequest request) {
        // í™œì„± ì‹¤í—˜ í™•ì¸
        List<Experiment> activeExperiments = experimentService
            .getActiveExperiments(request.getUserId());
        
        for (Experiment experiment : activeExperiments) {
            if (experiment.matches(request)) {
                // ì‹¤í—˜ ê·¸ë£¹ í• ë‹¹
                ExperimentGroup group = assignToGroup(
                    request.getUserId(), 
                    experiment
                );
                
                // ê·¸ë£¹ë³„ ë¼ìš°íŒ…
                RouterResponse response = routeToVariant(
                    request, 
                    group.getVariant()
                );
                
                // ì‹¤í—˜ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
                collectExperimentMetrics(experiment, group, response);
                
                return response;
            }
        }
        
        // ê¸°ë³¸ ë¼ìš°íŒ… (ëŒ€ì¡°êµ°)
        return routeToControl(request);
    }
    
    private ExperimentGroup assignToGroup(String userId, Experiment experiment) {
        // ì¼ê´€ëœ ê·¸ë£¹ í• ë‹¹ì„ ìœ„í•œ í•´ì‹±
        int hash = (userId + experiment.getId()).hashCode();
        double bucket = (Math.abs(hash) % 100) / 100.0;
        
        double cumulative = 0;
        for (ExperimentGroup group : experiment.getGroups()) {
            cumulative += group.getTrafficPercentage();
            if (bucket < cumulative) {
                return group;
            }
        }
        
        return experiment.getControlGroup();
    }
    
    private void collectExperimentMetrics(
            Experiment experiment, 
            ExperimentGroup group, 
            RouterResponse response) {
        
        ExperimentMetric metric = ExperimentMetric.builder()
            .experimentId(experiment.getId())
            .groupId(group.getId())
            .userId(response.getUserId())
            .latency(response.getLatency())
            .tokenCount(response.getTokenCount())
            .cost(response.getCost())
            .qualityScore(evaluateQuality(response))
            .timestamp(Instant.now())
            .build();
        
        metricsCollector.collect(metric);
        
        // ì‹¤ì‹œê°„ í†µê³„ ì—…ë°ì´íŠ¸
        updateExperimentStats(experiment, group, metric);
    }
    
    // ì‹¤í—˜ ê²°ê³¼ ë¶„ì„
    @Scheduled(cron = "0 0 * * * *") // ë§¤ì‹œê°„
    public void analyzeExperiments() {
        List<Experiment> experiments = experimentService.getRunningExperiments();
        
        for (Experiment experiment : experiments) {
            ExperimentAnalysis analysis = analyzeExperiment(experiment);
            
            if (analysis.hasSignificantResults()) {
                if (analysis.getWinner() != null) {
                    // ìŠ¹ì ë³€í˜•ì„ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì •
                    promoteWinner(experiment, analysis.getWinner());
                } else if (analysis.shouldStop()) {
                    // ì‹¤í—˜ ì¤‘ë‹¨
                    experimentService.stopExperiment(experiment.getId());
                }
            }
        }
    }
}</code></pre>
                    </div>
                </div>

                <!-- Contextual Routing -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ë¼ìš°íŒ…</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('contextual-routing')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="contextual-routing"><code class="language-java">@Service
public class ContextualRouter {
    
    private final UserContextService userContextService;
    private final ConversationHistoryService historyService;
    private final DomainDetector domainDetector;
    
    public RouterResponse routeWithContext(RouterRequest request) {
        // ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸ ë¡œë“œ
        UserContext userContext = userContextService.getContext(request.getUserId());
        
        // ëŒ€í™” íˆìŠ¤í† ë¦¬ ë¶„ì„
        ConversationContext convContext = historyService.analyze(
            request.getConversationId()
        );
        
        // ë„ë©”ì¸ ê°ì§€
        Domain domain = domainDetector.detect(request, convContext);
        
        // ì»¨í…ìŠ¤íŠ¸ ê¸°ë°˜ ë¼ìš°íŒ… ê²°ì •
        RoutingDecision decision = makeContextualDecision(
            request, 
            userContext, 
            convContext, 
            domain
        );
        
        return executeWithContext(request, decision);
    }
    
    private RoutingDecision makeContextualDecision(
            RouterRequest request,
            UserContext userContext,
            ConversationContext convContext,
            Domain domain) {
        
        // ì „ë¬¸ ë„ë©”ì¸ ìš”ì²­
        if (domain.requiresExpertise()) {
            return RoutingDecision.toExpert(domain.getExpertModel());
        }
        
        // ì—°ì† ëŒ€í™”
        if (convContext.isContinuation()) {
            // ì´ì „ê³¼ ë™ì¼í•œ ëª¨ë¸ ì‚¬ìš©ìœ¼ë¡œ ì¼ê´€ì„± ìœ ì§€
            return RoutingDecision.toPrevious(convContext.getLastModel());
        }
        
        // ì‚¬ìš©ì ì„ í˜¸ë„
        if (userContext.hasPreference()) {
            ModelPreference preference = userContext.getModelPreference();
            if (isAvailable(preference.getPreferredModel())) {
                return RoutingDecision.toPreferred(preference);
            }
        }
        
        // ì‘ì—… ë³µì¡ë„ ë¶„ì„
        ComplexityAnalysis complexity = analyzeComplexity(request);
        
        return switch (complexity.getLevel()) {
            case LOW -> RoutingDecision.toFast("gpt-4o-mini");
            case MEDIUM -> RoutingDecision.toBalanced("gpt-4o");
            case HIGH -> RoutingDecision.toPowerful("claude-3-opus");
            case EXPERT -> RoutingDecision.toSpecialist(complexity.getDomain());
        };
    }
    
    // ë‹¤ì¤‘ ë‹¨ê³„ ë¼ìš°íŒ…
    public MultiStageResponse routeMultiStage(ComplexRequest request) {
        List<Stage> stages = planStages(request);
        Map<String, StageResult> results = new LinkedHashMap<>();
        
        for (Stage stage : stages) {
            // ì´ì „ ë‹¨ê³„ ê²°ê³¼ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ í¬í•¨
            StageContext context = buildStageContext(stage, results);
            
            // ë‹¨ê³„ë³„ ìµœì  ëª¨ë¸ ì„ íƒ
            ModelSelection selection = selectModelForStage(stage, context);
            
            // ì‹¤í–‰
            StageResult result = executeStage(stage, selection, context);
            results.put(stage.getName(), result);
            
            // ì¡°ê¸° ì¢…ë£Œ ì¡°ê±´ í™•ì¸
            if (shouldTerminateEarly(stage, result)) {
                break;
            }
        }
        
        return MultiStageResponse.builder()
            .request(request)
            .stages(stages)
            .results(results)
            .finalOutput(combineSt ageResults(results))
            .build();
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Real-World Examples -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">ì‹¤ì „ ì˜ˆì œ</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ê³ ê° ì§€ì› ë¼ìš°íŒ… ì‹œìŠ¤í…œ</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('customer-support')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="customer-support"><code class="language-java">@Service
public class CustomerSupportRouter {
    
    private final Map<SupportCategory, SupportAgent> specializedAgents;
    private final EmotionDetector emotionDetector;
    private final UrgencyClassifier urgencyClassifier;
    
    public SupportResponse routeSupport(SupportRequest request) {
        // ê°ì • ìƒíƒœ ë¶„ì„
        EmotionState emotion = emotionDetector.detect(request.getMessage());
        
        // ê¸´ê¸‰ë„ ë¶„ë¥˜
        UrgencyLevel urgency = urgencyClassifier.classify(request);
        
        // ì¹´í…Œê³ ë¦¬ ìë™ ë¶„ë¥˜
        SupportCategory category = categorizeRequest(request);
        
        // ë¼ìš°íŒ… ê²°ì •
        if (urgency == UrgencyLevel.CRITICAL || emotion.isNegative()) {
            // ê¸´ê¸‰í•˜ê±°ë‚˜ ë¶€ì •ì  ê°ì •ì´ë©´ ì¸ê°„ ìƒë‹´ì›ì—ê²Œ
            return routeToHumanAgent(request, category);
        }
        
        // ì „ë¬¸ AI ì—ì´ì „íŠ¸ ì„ íƒ
        SupportAgent agent = selectSpecializedAgent(category, request);
        
        // ë§¥ë½ ì •ë³´ ì¶”ê°€
        EnrichedRequest enriched = enrichRequest(request, category, emotion);
        
        return agent.handleRequest(enriched);
    }
    
    private SupportAgent selectSpecializedAgent(
            SupportCategory category, 
            SupportRequest request) {
        
        return switch (category) {
            case TECHNICAL -> new TechnicalSupportAgent();
            case BILLING -> new BillingSupportAgent();
            case PRODUCT_INFO -> new ProductInfoAgent();
            case COMPLAINT -> new ComplaintHandlingAgent();
            case GENERAL -> new GeneralSupportAgent();
        };
    }
    
    // ê¸°ìˆ  ì§€ì› ì „ë¬¸ ì—ì´ì „íŠ¸
    @Component
    public class TechnicalSupportAgent extends SupportAgent {
        
        @Override
        public SupportResponse handleRequest(EnrichedRequest request) {
            // ë¬¸ì œ ìœ í˜• ì„¸ë¶„í™”
            TechIssueType issueType = analyzeTechIssue(request);
            
            return switch (issueType) {
                case INSTALLATION -> handleInstallation(request);
                case CONFIGURATION -> handleConfiguration(request);
                case BUG_REPORT -> handleBugReport(request);
                case PERFORMANCE -> handlePerformance(request);
                case INTEGRATION -> handleIntegration(request);
            };
        }
        
        private SupportResponse handleBugReport(EnrichedRequest request) {
            // ë²„ê·¸ ì¬í˜„ ë‹¨ê³„ ì¶”ì¶œ
            List<String> reproSteps = extractReproductionSteps(request);
            
            // ì•Œë ¤ì§„ ì´ìŠˆ ê²€ìƒ‰
            List<KnownIssue> similarIssues = searchKnownIssues(request);
            
            if (!similarIssues.isEmpty()) {
                return provideSolution(similarIssues.get(0));
            }
            
            // ìƒˆë¡œìš´ ë²„ê·¸ ë¦¬í¬íŠ¸ ìƒì„±
            BugReport report = createBugReport(request, reproSteps);
            
            return SupportResponse.builder()
                .message("ë²„ê·¸ ë¦¬í¬íŠ¸ê°€ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.")
                .ticketId(report.getId())
                .expectedResolution("24-48ì‹œê°„")
                .workaround(suggestWorkaround(request))
                .build();
        }
    }
}

// ì–¸ì–´ë³„ ë¼ìš°íŒ…
@Service
public class MultilingualRouter {
    
    private final Map<Language, ChatClient> languageModels;
    private final LanguageDetector languageDetector;
    
    public RouterResponse routeByLanguage(RouterRequest request) {
        // ì–¸ì–´ ê°ì§€
        Language detected = languageDetector.detect(request.getContent());
        
        // ì–¸ì–´ë³„ ìµœì  ëª¨ë¸ ì„ íƒ
        ChatClient client = languageModels.get(detected);
        
        if (client == null) {
            // ì§€ì›í•˜ì§€ ì•ŠëŠ” ì–¸ì–´ëŠ” ë²ˆì—­ í›„ ì²˜ë¦¬
            String translated = translateToEnglish(request.getContent());
            RouterResponse response = processInEnglish(translated);
            return translateBack(response, detected);
        }
        
        // í•´ë‹¹ ì–¸ì–´ ì „ë¬¸ ëª¨ë¸ë¡œ ì§ì ‘ ì²˜ë¦¬
        return processWithNativeModel(request, client, detected);
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Monitoring and Optimization -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">ëª¨ë‹ˆí„°ë§ ë° ìµœì í™”</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold mb-3">ë¼ìš°íŒ… ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('routing-monitoring')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="routing-monitoring"><code class="language-java">@Component
@Slf4j
public class RoutingMonitor {
    
    private final MeterRegistry meterRegistry;
    private final RoutingAnalytics analytics;
    
    @EventListener
    public void onRoutingDecision(RoutingEvent event) {
        // ë¼ìš°íŒ… ê²°ì • ë©”íŠ¸ë¦­
        meterRegistry.counter("routing.decisions",
            "type", event.getRequestType(),
            "target", event.getTargetModel(),
            "reason", event.getRoutingReason()
        ).increment();
        
        // ë¼ìš°íŒ… ì‹œê°„
        meterRegistry.timer("routing.decision.time",
            "type", event.getRequestType()
        ).record(event.getDecisionTime());
    }
    
    @EventListener
    public void onRoutingComplete(RoutingCompleteEvent event) {
        // ì—”ë“œíˆ¬ì—”ë“œ ë©”íŠ¸ë¦­
        meterRegistry.timer("routing.total.time",
            "model", event.getModel(),
            "success", String.valueOf(event.isSuccess())
        ).record(event.getTotalTime());
        
        // ë¹„ìš© ì¶”ì 
        meterRegistry.gauge("routing.cost",
            Tags.of("model", event.getModel()),
            event.getCost()
        );
        
        // í’ˆì§ˆ ì ìˆ˜
        if (event.hasQualityScore()) {
            meterRegistry.gauge("routing.quality",
                Tags.of("model", event.getModel()),
                event.getQualityScore()
            );
        }
    }
    
    // ë¼ìš°íŒ… íš¨ìœ¨ì„± ë¶„ì„
    @Scheduled(fixedDelay = 600000) // 10ë¶„ë§ˆë‹¤
    public void analyzeRoutingEfficiency() {
        RoutingStats stats = analytics.calculateStats();
        
        // ëª¨ë¸ë³„ ì„±ëŠ¥ ë¹„êµ
        Map<String, ModelPerformance> modelStats = stats.getModelPerformance();
        
        modelStats.forEach((model, perf) -> {
            log.info("Model {} - Success: {}, Avg Latency: {}ms, Cost/Request: ${}",
                model, 
                perf.getSuccessRate(),
                perf.getAvgLatency(),
                perf.getAvgCost()
            );
            
            // ë¹„íš¨ìœ¨ì  ë¼ìš°íŒ… ê°ì§€
            if (perf.getSuccessRate() < 0.8) {
                alertManager.sendAlert(
                    "Low success rate for model: " + model
                );
            }
            
            if (perf.getAvgLatency() > 5000) {
                alertManager.sendAlert(
                    "High latency for model: " + model
                );
            }
        });
        
        // ë¼ìš°íŒ… íŒ¨í„´ ë¶„ì„
        analyzeRoutingPatterns(stats);
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Best Practices -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">ğŸ¯ Best Practices</h2>
                
                <div class="bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg p-6">
                    <h3 class="text-lg font-semibold mb-4">ìŠ¤ë§ˆíŠ¸ ë¼ìš°íŒ… ì„¤ê³„ ì›ì¹™</h3>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold mb-2">ë¼ìš°íŒ… ì „ëµ</h4>
                            <ul class="space-y-1 text-sm">
                                <li>âœ… ëª…í™•í•œ ë¶„ë¥˜ ê¸°ì¤€ ì •ì˜</li>
                                <li>âœ… í´ë°± ë©”ì»¤ë‹ˆì¦˜ í•„ìˆ˜ êµ¬í˜„</li>
                                <li>âœ… ì‹¤ì‹œê°„ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§</li>
                                <li>âœ… ë¹„ìš©ê³¼ ì„±ëŠ¥ì˜ ê· í˜• ê³ ë ¤</li>
                                <li>âœ… ì‚¬ìš©ì ë§¥ë½ ì •ë³´ í™œìš©</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold mb-2">ìµœì í™” í¬ì¸íŠ¸</h4>
                            <ul class="space-y-1 text-sm">
                                <li>âœ… ë¶„ë¥˜ ë¡œì§ ìºì‹±</li>
                                <li>âœ… ë¹ ë¥¸ ê·œì¹™ ê¸°ë°˜ ì‚¬ì „ í•„í„°ë§</li>
                                <li>âœ… ë¡œë“œ ë°¸ëŸ°ì‹±ìœ¼ë¡œ ë¶€í•˜ ë¶„ì‚°</li>
                                <li>âœ… A/B í…ŒìŠ¤íŠ¸ë¡œ ì§€ì†ì  ê°œì„ </li>
                                <li>âœ… ì‹¤íŒ¨ íŒ¨í„´ í•™ìŠµ ë° ê°œì„ </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="font-semibold mb-2">ë¼ìš°íŒ… ê²°ì • ì²´í¬ë¦¬ìŠ¤íŠ¸</h4>
                        <div class="bg-white p-4 rounded-lg">
                            <ul class="space-y-1 text-sm">
                                <li>â–¡ ìš”ì²­ ìœ í˜•ì´ ëª…í™•íˆ ë¶„ë¥˜ë˜ëŠ”ê°€?</li>
                                <li>â–¡ ì ì ˆí•œ ëª¨ë¸/ì—ì´ì „íŠ¸ê°€ ì„ íƒë˜ëŠ”ê°€?</li>
                                <li>â–¡ í´ë°± ì˜µì…˜ì´ ì¤€ë¹„ë˜ì–´ ìˆëŠ”ê°€?</li>
                                <li>â–¡ ë¼ìš°íŒ… ê²°ì •ì´ ì¶”ì  ê°€ëŠ¥í•œê°€?</li>
                                <li>â–¡ ì„±ëŠ¥ ë©”íŠ¸ë¦­ì´ ìˆ˜ì§‘ë˜ëŠ”ê°€?</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Next Steps -->
            <section class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-xl font-semibold mb-4">ë‹¤ìŒ ë‹¨ê³„</h2>
                
                <div class="grid md:grid-cols-3 gap-4">
                    <a href="chain.html" class="block p-4 border rounded-lg hover:bg-gray-50 transition">
                        <h3 class="font-semibold text-blue-600 mb-2">Chain Workflow</h3>
                        <p class="text-sm text-gray-600">ìˆœì°¨ ì²˜ë¦¬ íŒ¨í„´ ì•Œì•„ë³´ê¸°</p>
                    </a>
                    
                    <a href="parallel.html" class="block p-4 border rounded-lg hover:bg-gray-50 transition">
                        <h3 class="font-semibold text-green-600 mb-2">Parallel Processing</h3>
                        <p class="text-sm text-gray-600">ë³‘ë ¬ ì²˜ë¦¬ íŒ¨í„´</p>
                    </a>
                    
                    <a href="../patterns.html" class="block p-4 border rounded-lg hover:bg-gray-50 transition">
                        <h3 class="font-semibold text-purple-600 mb-2">íŒ¨í„´ ëª©ë¡</h3>
                        <p class="text-sm text-gray-600">ì „ì²´ íŒ¨í„´ ë³´ê¸°</p>
                    </a>
                </div>
            </section>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
        function copyCode(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showNotification('ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg z-50';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 2000);
        }
    </script>
</body>
</html>