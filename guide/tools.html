<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring AI Tool Calling ê°€ì´ë“œ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .code-block { background: #2d3748; border-radius: 8px; }
        .copy-button { transition: all 0.2s ease; }
        .copy-button:hover { background-color: #4a5568; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <a href="../index.html" class="flex items-center text-xl font-bold text-gray-800">
                        <i class="fab fa-spring text-green-600 mr-2"></i>
                        Spring AI Hub
                    </a>
                    <span class="mx-3 text-gray-400">/</span>
                    <span class="text-gray-600">Tool Calling ê°€ì´ë“œ</span>
                </div>
                <a href="../index.html" class="text-blue-600 hover:text-blue-800">
                    <i class="fas fa-home"></i> í™ˆìœ¼ë¡œ
                </a>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl font-bold mb-4">ğŸ› ï¸ Tool Calling (Function Calling) ê°€ì´ë“œ</h1>
            <p class="text-gray-600 mb-8">AIê°€ ì™¸ë¶€ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ ì‹¤ì œ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë„ë¡ êµ¬í˜„í•˜ëŠ” ë°©ë²•</p>

            <!-- Table of Contents -->
            <div class="bg-white rounded-lg shadow-sm p-6 mb-8">
                <h2 class="text-xl font-semibold mb-4">ëª©ì°¨</h2>
                <ul class="space-y-2 text-blue-600">
                    <li><a href="#introduction" class="hover:underline">1. Tool Calling ì†Œê°œ</a></li>
                    <li><a href="#basic-implementation" class="hover:underline">2. ê¸°ë³¸ êµ¬í˜„</a></li>
                    <li><a href="#advanced-tools" class="hover:underline">3. ê³ ê¸‰ ë„êµ¬ êµ¬í˜„</a></li>
                    <li><a href="#error-handling" class="hover:underline">4. ì—ëŸ¬ ì²˜ë¦¬</a></li>
                    <li><a href="#best-practices" class="hover:underline">5. ëª¨ë²” ì‚¬ë¡€</a></li>
                    <li><a href="#real-examples" class="hover:underline">6. ì‹¤ì „ ì˜ˆì œ</a></li>
                </ul>
            </div>

            <!-- Section 1: Introduction -->
            <section id="introduction" class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">1. Tool Calling ì†Œê°œ</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <p class="mb-4">
                        Tool Calling (Function Calling)ì€ AI ëª¨ë¸ì´ ìì—°ì–´ ìš”ì²­ì„ ì´í•´í•˜ê³  ì ì ˆí•œ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ì—¬ 
                        ì‹¤ì œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê¸°ëŠ¥ì…ë‹ˆë‹¤.
                    </p>
                    
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <h3 class="font-semibold mb-2">ì£¼ìš” ì‚¬ìš© ì‚¬ë¡€:</h3>
                        <ul class="space-y-1">
                            <li>âœ… ì‹¤ì‹œê°„ ë°ì´í„° ì¡°íšŒ (ë‚ ì”¨, ì£¼ì‹ ë“±)</li>
                            <li>âœ… ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—…</li>
                            <li>âœ… ì™¸ë¶€ API í˜¸ì¶œ</li>
                            <li>âœ… íŒŒì¼ ì‹œìŠ¤í…œ ì‘ì—…</li>
                            <li>âœ… ì´ë©”ì¼/ì•Œë¦¼ ë°œì†¡</li>
                        </ul>
                    </div>

                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 class="font-semibold mb-2">ì‘ë™ ì›ë¦¬:</h3>
                        <pre class="text-sm">
1. ì‚¬ìš©ìê°€ ìì—°ì–´ë¡œ ìš”ì²­
    â†“
2. AIê°€ ìš”ì²­ ë¶„ì„ ë° ì ì ˆí•œ ë„êµ¬ ì„ íƒ
    â†“
3. ë„êµ¬ì— í•„ìš”í•œ íŒŒë¼ë¯¸í„° ì¶”ì¶œ
    â†“
4. ë„êµ¬ ì‹¤í–‰ ë° ê²°ê³¼ ë°˜í™˜
    â†“
5. AIê°€ ê²°ê³¼ë¥¼ ìì—°ì–´ë¡œ ë³€í™˜í•˜ì—¬ ì‘ë‹µ
                        </pre>
                    </div>
                </div>
            </section>

            <!-- Section 2: Basic Implementation -->
            <section id="basic-implementation" class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">2. ê¸°ë³¸ êµ¬í˜„</h2>
                
                <!-- Simple Tool -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ë‹¨ìˆœí•œ ë„êµ¬ ì •ì˜</h3>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('simple-tool')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="simple-tool"><code class="language-java">@Component
public class WeatherTools {
    
    @Tool("í˜„ì¬ ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤")
    public WeatherInfo getCurrentWeather(
        @ToolParam("ë„ì‹œ ì´ë¦„") String city,
        @ToolParam("ì˜¨ë„ ë‹¨ìœ„ (celsius/fahrenheit)") String unit
    ) {
        // ì‹¤ì œ ë‚ ì”¨ API í˜¸ì¶œ
        return weatherService.getWeather(city, unit);
    }
    
    @Tool("ì¼ì£¼ì¼ ë‚ ì”¨ ì˜ˆë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤")
    public WeeklyForecast getWeeklyForecast(
        @ToolParam("ë„ì‹œ ì´ë¦„") String city
    ) {
        return weatherService.getWeeklyForecast(city);
    }
}

// ë„êµ¬ë¥¼ ì‚¬ìš©í•˜ëŠ” ì„œë¹„ìŠ¤
@Service
public class AssistantService {
    
    private final ChatClient chatClient;
    
    public AssistantService(ChatClient.Builder builder) {
        this.chatClient = builder
            .defaultFunctions("getCurrentWeather", "getWeeklyForecast")
            .build();
    }
    
    public String chat(String message) {
        return chatClient.prompt()
            .user(message)
            .call()
            .content();
    }
}</code></pre>
                    </div>

                    <div class="bg-green-50 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">ì‚¬ìš© ì˜ˆì‹œ:</h4>
                        <p class="text-sm mb-2">ì‚¬ìš©ì: "ì„œìš¸ì˜ í˜„ì¬ ë‚ ì”¨ ì–´ë•Œ?"</p>
                        <p class="text-sm text-gray-600">
                            AIê°€ ìë™ìœ¼ë¡œ getCurrentWeather("ì„œìš¸", "celsius")ë¥¼ í˜¸ì¶œí•˜ê³  
                            ê²°ê³¼ë¥¼ ìì—°ì–´ë¡œ ë³€í™˜í•˜ì—¬ ì‘ë‹µí•©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>

                <!-- Configuration -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ì„¤ì • ë°©ë²•</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('tool-config')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="tool-config"><code class="language-java">@Configuration
public class ToolConfiguration {
    
    @Bean
    public FunctionCallbackWrapper<WeatherRequest, WeatherResponse> weatherFunction() {
        return FunctionCallbackWrapper.builder(new WeatherFunction())
            .withName("getWeather")
            .withDescription("Get current weather for a city")
            .withResponseConverter(response -> response.toString())
            .build();
    }
    
    @Bean
    public ChatClient chatClient(ChatClient.Builder builder, 
                                 List<FunctionCallbackWrapper> functions) {
        return builder
            .defaultOptions(OpenAiChatOptions.builder()
                .withModel("gpt-4o")
                .withTemperature(0.7f)
                .withFunctions(functions.stream()
                    .map(FunctionCallbackWrapper::getName)
                    .toList())
                .build())
            .defaultFunctions(functions.toArray(new FunctionCallbackWrapper[0]))
            .build();
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Section 3: Advanced Tools -->
            <section id="advanced-tools" class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">3. ê³ ê¸‰ ë„êµ¬ êµ¬í˜„</h2>
                
                <!-- Database Operations -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ë°ì´í„°ë² ì´ìŠ¤ ì‘ì—… ë„êµ¬</h3>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('database-tools')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="database-tools"><code class="language-java">@Component
@Transactional
public class CustomerDatabaseTools {
    
    private final CustomerRepository customerRepository;
    private final OrderRepository orderRepository;
    
    @Tool("ê³ ê° ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤")
    public CustomerInfo getCustomerInfo(
        @ToolParam("ê³ ê° ID ë˜ëŠ” ì´ë©”ì¼") String identifier
    ) {
        Customer customer = identifier.contains("@") 
            ? customerRepository.findByEmail(identifier)
            : customerRepository.findById(Long.parseLong(identifier))
            .orElseThrow(() -> new CustomerNotFoundException(identifier));
        
        return CustomerInfo.builder()
            .id(customer.getId())
            .name(customer.getName())
            .email(customer.getEmail())
            .registrationDate(customer.getCreatedAt())
            .totalOrders(customer.getOrders().size())
            .build();
    }
    
    @Tool("ê³ ê°ì˜ ì£¼ë¬¸ ë‚´ì—­ì„ ì¡°íšŒí•©ë‹ˆë‹¤")
    public List<OrderSummary> getCustomerOrders(
        @ToolParam("ê³ ê° ID") Long customerId,
        @ToolParam("ì¡°íšŒí•  ì£¼ë¬¸ ìˆ˜ (ê¸°ë³¸: 10)") Integer limit
    ) {
        int orderLimit = limit != null ? limit : 10;
        
        return orderRepository.findByCustomerId(customerId, 
            PageRequest.of(0, orderLimit, Sort.by("createdAt").descending()))
            .stream()
            .map(this::toOrderSummary)
            .toList();
    }
    
    @Tool("ìƒˆë¡œìš´ ê³ ê° ë©”ëª¨ë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤")
    public String addCustomerNote(
        @ToolParam("ê³ ê° ID") Long customerId,
        @ToolParam("ë©”ëª¨ ë‚´ìš©") String note,
        @ToolParam("ì¤‘ìš”ë„ (LOW/MEDIUM/HIGH)") String priority
    ) {
        Customer customer = customerRepository.findById(customerId)
            .orElseThrow(() -> new CustomerNotFoundException(customerId));
        
        CustomerNote customerNote = CustomerNote.builder()
            .customer(customer)
            .content(note)
            .priority(Priority.valueOf(priority.toUpperCase()))
            .createdBy("AI Assistant")
            .createdAt(LocalDateTime.now())
            .build();
        
        customerNoteRepository.save(customerNote);
        
        return "ë©”ëª¨ê°€ ì„±ê³µì ìœ¼ë¡œ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤. ID: " + customerNote.getId();
    }
    
    @Tool("ê³ ê°ì˜ êµ¬ë§¤ í†µê³„ë¥¼ ë¶„ì„í•©ë‹ˆë‹¤")
    public CustomerAnalytics analyzeCustomer(
        @ToolParam("ê³ ê° ID") Long customerId
    ) {
        List<Order> orders = orderRepository.findByCustomerId(customerId);
        
        return CustomerAnalytics.builder()
            .totalOrders(orders.size())
            .totalSpent(orders.stream()
                .map(Order::getTotalAmount)
                .reduce(BigDecimal.ZERO, BigDecimal::add))
            .averageOrderValue(calculateAverage(orders))
            .favoriteCategory(findFavoriteCategory(orders))
            .lastOrderDate(findLastOrderDate(orders))
            .churnRisk(calculateChurnRisk(orders))
            .build();
    }
}</code></pre>
                    </div>
                </div>

                <!-- Multi-Step Tools -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ë³µí•© ì‘ì—… ë„êµ¬</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('complex-tools')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="complex-tools"><code class="language-java">@Component
public class BusinessProcessTools {
    
    @Tool("íŒë§¤ ë³´ê³ ì„œë¥¼ ìƒì„±í•˜ê³  ì´ë©”ì¼ë¡œ ë°œì†¡í•©ë‹ˆë‹¤")
    public ReportResult generateAndSendSalesReport(
        @ToolParam("ì‹œì‘ ë‚ ì§œ (YYYY-MM-DD)") String startDate,
        @ToolParam("ì¢…ë£Œ ë‚ ì§œ (YYYY-MM-DD)") String endDate,
        @ToolParam("ìˆ˜ì‹ ì ì´ë©”ì¼ ëª©ë¡ (ì‰¼í‘œë¡œ êµ¬ë¶„)") String recipients,
        @ToolParam("ë³´ê³ ì„œ í˜•ì‹ (PDF/EXCEL)") String format
    ) {
        // 1. ë°ì´í„° ìˆ˜ì§‘
        LocalDate start = LocalDate.parse(startDate);
        LocalDate end = LocalDate.parse(endDate);
        SalesData salesData = salesService.getSalesData(start, end);
        
        // 2. ë³´ê³ ì„œ ìƒì„±
        byte[] report = format.equalsIgnoreCase("PDF") 
            ? reportGenerator.generatePDF(salesData)
            : reportGenerator.generateExcel(salesData);
        
        // 3. ì´ë©”ì¼ ë°œì†¡
        List<String> emailList = Arrays.asList(recipients.split(","));
        EmailResult emailResult = emailService.sendReport(
            emailList,
            "íŒë§¤ ë³´ê³ ì„œ " + startDate + " ~ " + endDate,
            "ìš”ì²­í•˜ì‹  íŒë§¤ ë³´ê³ ì„œë¥¼ ì²¨ë¶€í•©ë‹ˆë‹¤.",
            report,
            "sales_report_" + startDate + "_" + endDate + "." + format.toLowerCase()
        );
        
        return ReportResult.builder()
            .reportGenerated(true)
            .emailSent(emailResult.isSuccess())
            .recipients(emailList)
            .reportSize(report.length)
            .message("ë³´ê³ ì„œê°€ ìƒì„±ë˜ì–´ " + emailList.size() + "ëª…ì—ê²Œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.")
            .build();
    }
    
    @Tool("ì¬ê³  ë¶€ì¡± ìƒí’ˆì„ í™•ì¸í•˜ê³  ìë™ ì£¼ë¬¸í•©ë‹ˆë‹¤")
    public RestockResult checkAndRestockInventory(
        @ToolParam("ìµœì†Œ ì¬ê³  ìˆ˜ì¤€") Integer minStockLevel,
        @ToolParam("ìë™ ì£¼ë¬¸ ìŠ¹ì¸ ì—¬ë¶€") Boolean autoApprove
    ) {
        // 1. ì¬ê³  ë¶€ì¡± ìƒí’ˆ í™•ì¸
        List<Product> lowStockProducts = inventoryService
            .findProductsBelowStock(minStockLevel);
        
        if (lowStockProducts.isEmpty()) {
            return RestockResult.noRestockNeeded();
        }
        
        // 2. ì£¼ë¬¸ ì œì•ˆ ìƒì„±
        List<PurchaseOrder> proposedOrders = lowStockProducts.stream()
            .map(product -> createRestockOrder(product, minStockLevel))
            .toList();
        
        // 3. ìë™ ìŠ¹ì¸ ë˜ëŠ” ëŒ€ê¸°
        if (autoApprove) {
            proposedOrders.forEach(order -> {
                order.setStatus(OrderStatus.APPROVED);
                purchaseOrderService.submit(order);
            });
            
            return RestockResult.builder()
                .ordersCreated(proposedOrders.size())
                .totalCost(calculateTotalCost(proposedOrders))
                .status("ì£¼ë¬¸ì´ ìë™ìœ¼ë¡œ ìŠ¹ì¸ë˜ì–´ ì²˜ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.")
                .orderIds(proposedOrders.stream()
                    .map(PurchaseOrder::getId)
                    .toList())
                .build();
        } else {
            proposedOrders.forEach(order -> {
                order.setStatus(OrderStatus.PENDING_APPROVAL);
                purchaseOrderService.save(order);
            });
            
            return RestockResult.builder()
                .ordersCreated(proposedOrders.size())
                .totalCost(calculateTotalCost(proposedOrders))
                .status("ì£¼ë¬¸ì´ ìƒì„±ë˜ì–´ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤.")
                .orderIds(proposedOrders.stream()
                    .map(PurchaseOrder::getId)
                    .toList())
                .build();
        }
    }
}</code></pre>
                    </div>
                </div>

                <!-- Async Tools -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ë¹„ë™ê¸° ë„êµ¬</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('async-tools')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="async-tools"><code class="language-java">@Component
public class AsyncProcessingTools {
    
    @Tool("ëŒ€ìš©ëŸ‰ ë°ì´í„° ë¶„ì„ ì‘ì—…ì„ ì‹œì‘í•©ë‹ˆë‹¤")
    @Async
    public CompletableFuture<AnalysisResult> startDataAnalysis(
        @ToolParam("ë°ì´í„°ì…‹ ID") String datasetId,
        @ToolParam("ë¶„ì„ ìœ í˜•") String analysisType
    ) {
        return CompletableFuture.supplyAsync(() -> {
            // ì¥ì‹œê°„ ì‹¤í–‰ë˜ëŠ” ë¶„ì„ ì‘ì—…
            Dataset dataset = datasetService.load(datasetId);
            
            return switch (analysisType.toUpperCase()) {
                case "STATISTICAL" -> performStatisticalAnalysis(dataset);
                case "PREDICTIVE" -> performPredictiveAnalysis(dataset);
                case "CLUSTERING" -> performClusteringAnalysis(dataset);
                default -> throw new UnsupportedAnalysisException(analysisType);
            };
        });
    }
    
    @Tool("ë¶„ì„ ì‘ì—… ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤")
    public JobStatus checkAnalysisStatus(
        @ToolParam("ì‘ì—… ID") String jobId
    ) {
        return jobStatusService.getStatus(jobId);
    }
    
    @Tool("ì¥ê¸° ì‹¤í–‰ ì‘ì—…ì„ ì˜ˆì•½í•©ë‹ˆë‹¤")
    public ScheduledJob scheduleJob(
        @ToolParam("ì‘ì—… ì´ë¦„") String jobName,
        @ToolParam("ì‹¤í–‰ ì‹œê°„ (cron í‘œí˜„ì‹)") String cronExpression,
        @ToolParam("ì‘ì—… ë§¤ê°œë³€ìˆ˜ (JSON)") String parameters
    ) {
        JobDetail jobDetail = JobBuilder.newJob(AIScheduledJob.class)
            .withIdentity(jobName, "ai-tools")
            .usingJobData("parameters", parameters)
            .build();
        
        Trigger trigger = TriggerBuilder.newTrigger()
            .withIdentity(jobName + "-trigger", "ai-tools")
            .withSchedule(CronScheduleBuilder.cronSchedule(cronExpression))
            .build();
        
        scheduler.scheduleJob(jobDetail, trigger);
        
        return ScheduledJob.builder()
            .jobId(jobDetail.getKey().toString())
            .name(jobName)
            .schedule(cronExpression)
            .nextExecution(trigger.getNextFireTime())
            .status("SCHEDULED")
            .build();
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Section 4: Error Handling -->
            <section id="error-handling" class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">4. ì—ëŸ¬ ì²˜ë¦¬</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ê°•ê±´í•œ ì—ëŸ¬ ì²˜ë¦¬</h3>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('error-handling')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="error-handling"><code class="language-java">@Component
@Slf4j
public class RobustToolWrapper {
    
    @Tool("ì•ˆì „í•œ ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ")
    public ToolResult safeDataQuery(
        @ToolParam("ì¿¼ë¦¬") String query
    ) {
        try {
            // ì…ë ¥ ê²€ì¦
            validateQuery(query);
            
            // ì‹¤í–‰ ì‹œê°„ ì œí•œ
            return CompletableFuture
                .supplyAsync(() -> executeQuery(query))
                .orTimeout(30, TimeUnit.SECONDS)
                .handle((result, throwable) -> {
                    if (throwable != null) {
                        log.error("Query execution failed", throwable);
                        return ToolResult.failure(
                            "ì¿¼ë¦¬ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + 
                            throwable.getMessage()
                        );
                    }
                    return ToolResult.success(result);
                })
                .join();
                
        } catch (ValidationException e) {
            return ToolResult.failure("ì˜ëª»ëœ ì¿¼ë¦¬ í˜•ì‹: " + e.getMessage());
        } catch (Exception e) {
            log.error("Unexpected error in tool execution", e);
            return ToolResult.failure("ì˜ˆê¸°ì¹˜ ì•Šì€ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        }
    }
    
    // ì¬ì‹œë„ ë¡œì§
    @Tool("ì™¸ë¶€ API í˜¸ì¶œ (ì¬ì‹œë„ í¬í•¨)")
    @Retryable(value = {ApiException.class}, maxAttempts = 3, backoff = @Backoff(delay = 1000))
    public ApiResponse callExternalApi(
        @ToolParam("ì—”ë“œí¬ì¸íŠ¸") String endpoint,
        @ToolParam("ë§¤ê°œë³€ìˆ˜") Map<String, Object> parameters
    ) {
        try {
            return apiClient.call(endpoint, parameters);
        } catch (ApiException e) {
            log.warn("API call failed, will retry. Endpoint: {}", endpoint);
            throw e;
        }
    }
    
    @Recover
    public ApiResponse recoverFromApiFailure(ApiException e, String endpoint, Map<String, Object> parameters) {
        log.error("All API call attempts failed for endpoint: {}", endpoint);
        return ApiResponse.builder()
            .success(false)
            .error("API í˜¸ì¶œì´ ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")
            .build();
    }
    
    // ê¶Œí•œ ê²€ì¦
    @Tool("ë¯¼ê°í•œ ì‘ì—… ìˆ˜í–‰")
    public SecureResult performSensitiveOperation(
        @ToolParam("ì‘ì—… ID") String operationId,
        @ToolParam("ì‚¬ìš©ì ì»¨í…ìŠ¤íŠ¸") String userContext
    ) {
        // ê¶Œí•œ í™•ì¸
        if (!securityService.hasPermission(userContext, operationId)) {
            return SecureResult.forbidden("ì´ ì‘ì—…ì„ ìˆ˜í–‰í•  ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤.");
        }
        
        // ê°ì‚¬ ë¡œê·¸
        auditService.log(AuditEvent.builder()
            .action("SENSITIVE_OPERATION")
            .operationId(operationId)
            .userContext(userContext)
            .timestamp(Instant.now())
            .build());
        
        // ì‹¤ì œ ì‘ì—… ìˆ˜í–‰
        return performOperation(operationId);
    }
}</code></pre>
                    </div>

                    <div class="bg-red-50 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">ì—ëŸ¬ ì²˜ë¦¬ ì²´í¬ë¦¬ìŠ¤íŠ¸:</h4>
                        <ul class="space-y-1 text-sm">
                            <li>âœ… ì…ë ¥ ê²€ì¦</li>
                            <li>âœ… íƒ€ì„ì•„ì›ƒ ì„¤ì •</li>
                            <li>âœ… ì¬ì‹œë„ ë¡œì§</li>
                            <li>âœ… í´ë°± ì²˜ë¦¬</li>
                            <li>âœ… ì—ëŸ¬ ë¡œê¹…</li>
                            <li>âœ… ì‚¬ìš©ì ì¹œí™”ì  ë©”ì‹œì§€</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Section 5: Best Practices -->
            <section id="best-practices" class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">5. ëª¨ë²” ì‚¬ë¡€</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ë„êµ¬ ì„¤ê³„ ì›ì¹™</h3>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">âœ… í•´ì•¼ í•  ê²ƒ</h4>
                            <ul class="space-y-1 text-sm">
                                <li>â€¢ ëª…í™•í•˜ê³  ì„¤ëª…ì ì¸ ë„êµ¬ ì´ë¦„ ì‚¬ìš©</li>
                                <li>â€¢ íŒŒë¼ë¯¸í„°ì— ìƒì„¸í•œ ì„¤ëª… ì¶”ê°€</li>
                                <li>â€¢ ë‹¨ì¼ ì±…ì„ ì›ì¹™ ì¤€ìˆ˜</li>
                                <li>â€¢ ì˜ˆìƒ ê°€ëŠ¥í•œ ê²°ê³¼ ë°˜í™˜</li>
                                <li>â€¢ ì ì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€ ì œê³µ</li>
                            </ul>
                        </div>
                        
                        <div class="bg-red-50 p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">âŒ í”¼í•´ì•¼ í•  ê²ƒ</h4>
                            <ul class="space-y-1 text-sm">
                                <li>â€¢ ë„ˆë¬´ ë³µì¡í•œ íŒŒë¼ë¯¸í„° êµ¬ì¡°</li>
                                <li>â€¢ ë¶€ì‘ìš©ì´ í° ì‘ì—…</li>
                                <li>â€¢ ë™ê¸°ì ìœ¼ë¡œ ì˜¤ë˜ ê±¸ë¦¬ëŠ” ì‘ì—…</li>
                                <li>â€¢ ì• ë§¤í•œ ë„êµ¬ ì„¤ëª…</li>
                                <li>â€¢ ê²€ì¦ë˜ì§€ ì•Šì€ ì…ë ¥ ì²˜ë¦¬</li>
                            </ul>
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold mb-3">ì„±ëŠ¥ ìµœì í™”</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('performance-tips')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="performance-tips"><code class="language-java">@Configuration
public class ToolPerformanceConfig {
    
    // ë„êµ¬ ê²°ê³¼ ìºì‹±
    @Bean
    public CacheManager toolCacheManager() {
        return CacheManagerBuilder.newCacheManagerBuilder()
            .withCache("toolResults",
                CacheConfigurationBuilder.newCacheConfigurationBuilder(
                    String.class, Object.class,
                    ResourcePoolsBuilder.heap(100)
                        .offheap(1, MemoryUnit.MB))
                    .withExpiry(ExpiryPolicyBuilder.timeToLiveExpiration(
                        Duration.ofMinutes(10)))
            )
            .build(true);
    }
    
    // ë„êµ¬ ì‹¤í–‰ ë©”íŠ¸ë¦­
    @Component
    @Aspect
    public class ToolMetricsAspect {
        
        private final MeterRegistry meterRegistry;
        
        @Around("@annotation(Tool)")
        public Object measureToolExecution(ProceedingJoinPoint pjp) throws Throwable {
            String toolName = pjp.getSignature().getName();
            
            return Timer.Sample
                .start(meterRegistry)
                .stop(Timer.builder("tool.execution.time")
                    .tag("tool", toolName)
                    .register(meterRegistry));
        }
    }
    
    // ë°°ì¹˜ ì²˜ë¦¬ ì§€ì›
    @Tool("ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬")
    public BatchResult processBatch(
        @ToolParam("í•­ëª© ID ëª©ë¡") List<String> itemIds
    ) {
        // ë³‘ë ¬ ì²˜ë¦¬
        List<CompletableFuture<ItemResult>> futures = itemIds.stream()
            .map(id -> CompletableFuture.supplyAsync(() -> processItem(id)))
            .toList();
        
        // ê²°ê³¼ ìˆ˜ì§‘
        List<ItemResult> results = CompletableFuture.allOf(
            futures.toArray(new CompletableFuture[0])
        ).thenApply(v -> futures.stream()
            .map(CompletableFuture::join)
            .toList()
        ).join();
        
        return BatchResult.of(results);
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Section 6: Real Examples -->
            <section id="real-examples" class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">6. ì‹¤ì „ ì˜ˆì œ</h2>
                
                <!-- E-commerce Assistant -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ì´ì»¤ë¨¸ìŠ¤ ì–´ì‹œìŠ¤í„´íŠ¸</h3>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('ecommerce-assistant')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="ecommerce-assistant"><code class="language-java">@Service
public class EcommerceAssistant {
    
    private final ChatClient chatClient;
    
    public EcommerceAssistant(ChatClient.Builder builder) {
        this.chatClient = builder
            .defaultFunctions(
                "searchProducts",
                "getProductDetails", 
                "checkInventory",
                "calculateShipping",
                "placeOrder",
                "trackOrder"
            )
            .build();
    }
    
    // ëŒ€í™”í˜• ì‡¼í•‘ ì–´ì‹œìŠ¤í„´íŠ¸
    public String assist(String userMessage, String sessionId) {
        return chatClient.prompt()
            .system("""
                ë‹¹ì‹ ì€ ì¹œì ˆí•œ ì‡¼í•‘ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.
                ê³ ê°ì´ ì›í•˜ëŠ” ìƒí’ˆì„ ì°¾ê³ , êµ¬ë§¤ ê²°ì •ì„ ë„ì™€ì£¼ì„¸ìš”.
                ì¬ê³  í™•ì¸, ë°°ì†¡ë¹„ ê³„ì‚°, ì£¼ë¬¸ ì²˜ë¦¬ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.
                """)
            .user(userMessage)
            .call()
            .content();
    }
}

@Component
public class EcommerceTools {
    
    @Tool("ìƒí’ˆì„ ê²€ìƒ‰í•©ë‹ˆë‹¤")
    public List<ProductSummary> searchProducts(
        @ToolParam("ê²€ìƒ‰ì–´") String query,
        @ToolParam("ì¹´í…Œê³ ë¦¬ (ì„ íƒì‚¬í•­)") String category,
        @ToolParam("ìµœì†Œ ê°€ê²© (ì„ íƒì‚¬í•­)") BigDecimal minPrice,
        @ToolParam("ìµœëŒ€ ê°€ê²© (ì„ íƒì‚¬í•­)") BigDecimal maxPrice
    ) {
        SearchCriteria criteria = SearchCriteria.builder()
            .query(query)
            .category(category)
            .priceRange(minPrice, maxPrice)
            .build();
            
        return productService.search(criteria).stream()
            .map(this::toSummary)
            .limit(10)
            .toList();
    }
    
    @Tool("ìƒí’ˆ ìƒì„¸ ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤")
    public ProductDetail getProductDetails(
        @ToolParam("ìƒí’ˆ ID") String productId
    ) {
        Product product = productService.findById(productId);
        
        return ProductDetail.builder()
            .id(product.getId())
            .name(product.getName())
            .description(product.getDescription())
            .price(product.getPrice())
            .images(product.getImages())
            .specifications(product.getSpecifications())
            .reviews(getTopReviews(productId))
            .rating(calculateAverageRating(productId))
            .build();
    }
    
    @Tool("ì¬ê³ ë¥¼ í™•ì¸í•©ë‹ˆë‹¤")
    public InventoryStatus checkInventory(
        @ToolParam("ìƒí’ˆ ID") String productId,
        @ToolParam("ìˆ˜ëŸ‰") Integer quantity
    ) {
        int availableStock = inventoryService.getAvailableStock(productId);
        
        return InventoryStatus.builder()
            .productId(productId)
            .requestedQuantity(quantity)
            .availableQuantity(availableStock)
            .inStock(availableStock >= quantity)
            .message(availableStock >= quantity 
                ? "ì¬ê³ ê°€ ì¶©ë¶„í•©ë‹ˆë‹¤." 
                : "ì¬ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. í˜„ì¬ " + availableStock + "ê°œ ë‚¨ì•˜ìŠµë‹ˆë‹¤.")
            .build();
    }
    
    @Tool("ì£¼ë¬¸ì„ ìƒì„±í•©ë‹ˆë‹¤")
    @Transactional
    public OrderResult placeOrder(
        @ToolParam("ì¥ë°”êµ¬ë‹ˆ í•­ëª©") List<CartItem> items,
        @ToolParam("ë°°ì†¡ ì£¼ì†Œ") ShippingAddress address,
        @ToolParam("ê²°ì œ ë°©ë²•") String paymentMethod
    ) {
        // ì¬ê³  í™•ì¸
        for (CartItem item : items) {
            InventoryStatus status = checkInventory(item.getProductId(), item.getQuantity());
            if (!status.isInStock()) {
                return OrderResult.failure("ì¬ê³  ë¶€ì¡±: " + item.getProductName());
            }
        }
        
        // ì£¼ë¬¸ ìƒì„±
        Order order = Order.builder()
            .items(items)
            .shippingAddress(address)
            .paymentMethod(paymentMethod)
            .status(OrderStatus.PENDING)
            .build();
        
        order = orderService.create(order);
        
        // ê²°ì œ ì²˜ë¦¬
        PaymentResult payment = paymentService.process(order);
        
        if (payment.isSuccess()) {
            order.setStatus(OrderStatus.CONFIRMED);
            orderService.save(order);
            
            // ì¬ê³  ì°¨ê°
            inventoryService.decreaseStock(items);
            
            // ë°°ì†¡ ì˜ˆì•½
            shippingService.schedule(order);
            
            return OrderResult.success(order.getId(), 
                "ì£¼ë¬¸ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì£¼ë¬¸ë²ˆí˜¸: " + order.getId());
        } else {
            return OrderResult.failure("ê²°ì œ ì‹¤íŒ¨: " + payment.getError());
        }
    }
}</code></pre>
                    </div>

                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">ì‚¬ìš© ì˜ˆì‹œ:</h4>
                        <div class="space-y-2 text-sm">
                            <p><strong>ì‚¬ìš©ì:</strong> "ë…¸íŠ¸ë¶ì„ ì°¾ê³  ìˆì–´ìš”"</p>
                            <p><strong>AI:</strong> searchProducts()ë¥¼ í˜¸ì¶œí•˜ì—¬ ë…¸íŠ¸ë¶ ëª©ë¡ì„ ë³´ì—¬ì¤ë‹ˆë‹¤</p>
                            <p><strong>ì‚¬ìš©ì:</strong> "ì²« ë²ˆì§¸ ì œí’ˆ ìì„¸íˆ ë³´ì—¬ì¤˜"</p>
                            <p><strong>AI:</strong> getProductDetails()ë¥¼ í˜¸ì¶œí•˜ì—¬ ìƒì„¸ ì •ë³´ ì œê³µ</p>
                            <p><strong>ì‚¬ìš©ì:</strong> "ì¬ê³  ìˆë‚˜ìš”?"</p>
                            <p><strong>AI:</strong> checkInventory()ë¥¼ í˜¸ì¶œí•˜ì—¬ ì¬ê³  í™•ì¸</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Tool Patterns -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">ğŸ¯ ë„êµ¬ íŒ¨í„´</h2>
                
                <div class="grid gap-4">
                    <div class="bg-gradient-to-r from-blue-50 to-purple-50 rounded-lg p-6">
                        <h3 class="text-lg font-semibold mb-3">ì²´ì¸ íŒ¨í„´</h3>
                        <p class="text-sm mb-3">ì—¬ëŸ¬ ë„êµ¬ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í˜¸ì¶œí•˜ì—¬ ë³µì¡í•œ ì‘ì—… ìˆ˜í–‰</p>
                        <div class="code-block p-3">
                            <pre><code class="language-java">// 1. ê³ ê° ì¡°íšŒ â†’ 2. ì£¼ë¬¸ ë‚´ì—­ í™•ì¸ â†’ 3. ì¶”ì²œ ìƒì„±
@Tool("ê°œì¸í™”ëœ ìƒí’ˆ ì¶”ì²œ")
public Recommendations getPersonalizedRecommendations(String customerId) {
    CustomerInfo customer = getCustomerInfo(customerId);
    List<Order> orderHistory = getOrderHistory(customerId);
    return generateRecommendations(customer, orderHistory);
}</code></pre>
                        </div>
                    </div>

                    <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-6">
                        <h3 class="text-lg font-semibold mb-3">ë¶„ê¸° íŒ¨í„´</h3>
                        <p class="text-sm mb-3">ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ë„êµ¬ í˜¸ì¶œ</p>
                        <div class="code-block p-3">
                            <pre><code class="language-java">@Tool("ìŠ¤ë§ˆíŠ¸ ê³ ê° ì§€ì›")
public SupportResult handleSupport(String issue, String customerId) {
    if (issue.contains("ì£¼ë¬¸")) {
        return handleOrderIssue(customerId);
    } else if (issue.contains("í™˜ë¶ˆ")) {
        return processRefund(customerId);
    } else {
        return escalateToHuman(issue, customerId);
    }
}</code></pre>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Next Steps -->
            <section class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-xl font-semibold mb-4">ë‹¤ìŒ ë‹¨ê³„</h2>
                
                <div class="grid md:grid-cols-3 gap-4">
                    <a href="agents.html" class="block p-4 border rounded-lg hover:bg-gray-50 transition">
                        <h3 class="font-semibold text-blue-600 mb-2">AI ì—ì´ì „íŠ¸</h3>
                        <p class="text-sm text-gray-600">ë„êµ¬ë¥¼ í™œìš©í•œ ììœ¨ ì—ì´ì „íŠ¸ êµ¬ì¶•</p>
                    </a>
                    
                    <a href="monitoring.html" class="block p-4 border rounded-lg hover:bg-gray-50 transition">
                        <h3 class="font-semibold text-green-600 mb-2">ë„êµ¬ ëª¨ë‹ˆí„°ë§</h3>
                        <p class="text-sm text-gray-600">ë„êµ¬ ì‚¬ìš© ì¶”ì  ë° ìµœì í™”</p>
                    </a>
                    
                    <a href="patterns.html" class="block p-4 border rounded-lg hover:bg-gray-50 transition">
                        <h3 class="font-semibold text-purple-600 mb-2">ê³ ê¸‰ íŒ¨í„´</h3>
                        <p class="text-sm text-gray-600">ë³µì¡í•œ ë„êµ¬ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜</p>
                    </a>
                </div>
            </section>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
        function copyCode(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showNotification('ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg z-50';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 2000);
        }
    </script>
</body>
</html>