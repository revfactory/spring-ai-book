<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advisors ê°€ì´ë“œ - Spring AI</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .code-block { background: #2d3748; border-radius: 8px; }
        .copy-button { transition: all 0.2s ease; }
        .copy-button:hover { background-color: #4a5568; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <a href="../index.html" class="flex items-center text-xl font-bold text-gray-800">
                        <i class="fab fa-spring text-green-600 mr-2"></i>
                        Spring AI Hub
                    </a>
                    <span class="mx-3 text-gray-400">/</span>
                    <span class="text-gray-600">Advisors ê°€ì´ë“œ</span>
                </div>
                <a href="../index.html" class="text-blue-600 hover:text-blue-800">
                    <i class="fas fa-home"></i> í™ˆìœ¼ë¡œ
                </a>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-4xl font-bold mb-4">ğŸ§­ Advisors ê°€ì´ë“œ</h1>
            <p class="text-gray-600 mb-8">Spring AI Advisor APIë¥¼ ì‚¬ìš©í•œ RAG ì‹œìŠ¤í…œ êµ¬ì¶•ê³¼ ê³ ê¸‰ íŒ¨í„´</p>

            <!-- Introduction -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">ê°œìš”</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <p class="mb-4">
                        Spring AIì˜ <strong>Advisor API</strong>ëŠ” ChatClientì˜ ìš”ì²­/ì‘ë‹µ í”Œë¡œìš°ì— ì‚¬ìš©ì ì •ì˜ ë¡œì§ì„ ì£¼ì…í•  ìˆ˜ ìˆëŠ” ê°•ë ¥í•œ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. 
                        Advisorë¥¼ í†µí•´ RAG(Retrieval Augmented Generation), ë©”ëª¨ë¦¬ ê´€ë¦¬, ì½˜í…ì¸  í•„í„°ë§ ë“±ì˜ ê³ ê¸‰ ê¸°ëŠ¥ì„ ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                    
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <h3 class="font-semibold mb-2">ì£¼ìš” íŠ¹ì§•:</h3>
                        <ul class="space-y-1">
                            <li>âœ… ìš”ì²­ ì „ì²˜ë¦¬ ë° ì‘ë‹µ í›„ì²˜ë¦¬</li>
                            <li>âœ… RAG ì‹œìŠ¤í…œ ìë™í™”</li>
                            <li>âœ… ëŒ€í™” ë©”ëª¨ë¦¬ ê´€ë¦¬</li>
                            <li>âœ… ì½˜í…ì¸  í•„í„°ë§ ë° ê²€ì¦</li>
                            <li>âœ… ëª¨ë“ˆí˜• ì•„í‚¤í…ì²˜</li>
                        </ul>
                    </div>

                    <div class="bg-gray-100 p-4 rounded-lg">
                        <h3 class="font-semibold mb-2">Advisor ì‹¤í–‰ ìˆœì„œ:</h3>
                        <pre class="text-sm font-mono">
ì‚¬ìš©ì ìš”ì²­
    â†“
Request Advisors (ìˆœì„œëŒ€ë¡œ ì‹¤í–‰)
    â†“
AI ëª¨ë¸ í˜¸ì¶œ
    â†“
Response Advisors (ì—­ìˆœìœ¼ë¡œ ì‹¤í–‰)
    â†“
ìµœì¢… ì‘ë‹µ
                        </pre>
                    </div>
                </div>
            </section>

            <!-- QuestionAnswerAdvisor -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">QuestionAnswerAdvisor</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ê¸°ë³¸ RAG êµ¬í˜„</h3>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('qa-advisor-basic')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="qa-advisor-basic"><code class="language-java">@Configuration
public class AdvisorConfig {
    
    @Bean
    public QuestionAnswerAdvisor questionAnswerAdvisor(VectorStore vectorStore) {
        return QuestionAnswerAdvisor.builder(vectorStore)
            .searchRequest(SearchRequest.builder()
                .similarityThreshold(0.8)
                .topK(5)
                .build())
            .build();
    }
}

@Service
public class RAGChatService {
    
    private final ChatClient chatClient;
    
    public RAGChatService(ChatClient.Builder chatClientBuilder, 
                         QuestionAnswerAdvisor qaAdvisor) {
        this.chatClient = chatClientBuilder
            .defaultAdvisors(qaAdvisor)
            .build();
    }
    
    public String chat(String userMessage) {
        return chatClient.prompt()
            .user(userMessage)
            .call()
            .content();
    }
    
    // ë™ì  í•„í„°ë§
    public String chatWithFilter(String userMessage, String category) {
        return chatClient.prompt()
            .user(userMessage)
            .advisors(a -&gt; a.param(
                QuestionAnswerAdvisor.FILTER_EXPRESSION, 
                "category == '" + category + "'"
            ))
            .call()
            .content();
    }
}</code></pre>
                    </div>
                </div>

                <!-- Custom Template -->
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ì»¤ìŠ¤í…€ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('qa-advisor-template')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="qa-advisor-template"><code class="language-java">@Bean
public QuestionAnswerAdvisor customQuestionAnswerAdvisor(VectorStore vectorStore) {
    
    PromptTemplate customTemplate = PromptTemplate.builder()
        .template("""
            ë‹¹ì‹ ì€ ì „ë¬¸ ìƒë‹´ì›ì…ë‹ˆë‹¤. ë‹¤ìŒ ë¬¸ì„œë“¤ì„ ì°¸ê³ í•˜ì—¬ ì •í™•í•˜ê³  ë„ì›€ì´ ë˜ëŠ” ë‹µë³€ì„ ì œê³µí•˜ì„¸ìš”.
            
            ì°¸ê³  ë¬¸ì„œ:
            {question_answer_context}
            
            ì‚¬ìš©ì ì§ˆë¬¸: {query}
            
            ë‹µë³€ ê·œì¹™:
            1. ì œê³µëœ ë¬¸ì„œì— ê¸°ë°˜í•˜ì—¬ ë‹µë³€í•˜ì„¸ìš”
            2. í™•ì‹¤í•˜ì§€ ì•Šì€ ì •ë³´ëŠ” ì¶”ì¸¡í•˜ì§€ ë§ˆì„¸ìš”
            3. ì¶œì²˜ë¥¼ ëª…ì‹œí•˜ì—¬ ì‹ ë¢°ì„±ì„ ë†’ì´ì„¸ìš”
            4. ì¹œê·¼í•˜ê³  ì „ë¬¸ì ì¸ í†¤ì„ ìœ ì§€í•˜ì„¸ìš”
            
            ë‹µë³€:
            """)
        .build();
    
    return QuestionAnswerAdvisor.builder(vectorStore)
        .searchRequest(SearchRequest.builder()
            .similarityThreshold(0.75)
            .topK(3)
            .build())
        .promptTemplate(customTemplate)
        .build();
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- VectorStoreChatMemoryAdvisor -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">VectorStoreChatMemoryAdvisor</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ëŒ€í™” ë©”ëª¨ë¦¬ ê´€ë¦¬</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('memory-advisor')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="memory-advisor"><code class="language-java">@Configuration
public class MemoryAdvisorConfig {
    
    @Bean
    public VectorStoreChatMemoryAdvisor chatMemoryAdvisor(
            VectorStore vectorStore,
            ChatMemoryStore chatMemoryStore) {
        
        return VectorStoreChatMemoryAdvisor.builder(vectorStore)
            .chatMemoryStore(chatMemoryStore)
            .defaultConversationId("global")
            .order(0) // QuestionAnswerAdvisorë³´ë‹¤ ë¨¼ì € ì‹¤í–‰
            .build();
    }
    
    @Bean
    public ChatMemoryStore chatMemoryStore() {
        return new InMemoryChatMemoryStore();
    }
}

@Service
public class ConversationalRAGService {
    
    private final ChatClient chatClient;
    
    public ConversationalRAGService(
            ChatClient.Builder chatClientBuilder,
            QuestionAnswerAdvisor qaAdvisor,
            VectorStoreChatMemoryAdvisor memoryAdvisor) {
        
        this.chatClient = chatClientBuilder
            .defaultAdvisors(memoryAdvisor, qaAdvisor)
            .build();
    }
    
    public String chat(String conversationId, String userMessage) {
        return chatClient.prompt()
            .user(userMessage)
            .advisors(a -&gt; a.param(
                VectorStoreChatMemoryAdvisor.CHAT_MEMORY_CONVERSATION_ID_KEY,
                conversationId
            ))
            .call()
            .content();
    }
    
    // ëŒ€í™” íˆìŠ¤í† ë¦¬ ì¡°íšŒ
    public List&lt;Message&gt; getConversationHistory(String conversationId) {
        ChatMemory chatMemory = chatMemoryStore.get(conversationId, "default");
        return chatMemory.getMessages();
    }
    
    // ëŒ€í™” ì´ˆê¸°í™”
    public void clearConversation(String conversationId) {
        chatMemoryStore.clear(conversationId, "default");
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- RetrievalAugmentationAdvisor -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">RetrievalAugmentationAdvisor</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ê³ ê¸‰ RAG íŒŒì´í”„ë¼ì¸</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('retrieval-advisor')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="retrieval-advisor"><code class="language-java">@Configuration
public class AdvancedRAGConfig {
    
    @Bean
    public RetrievalAugmentationAdvisor retrievalAugmentationAdvisor(
            VectorStore vectorStore,
            ChatClient.Builder chatClientBuilder) {
        
        return RetrievalAugmentationAdvisor.builder()
            // ì¿¼ë¦¬ ì „ì²˜ë¦¬
            .queryTransformers(
                RewriteQueryTransformer.builder()
                    .chatClientBuilder(chatClientBuilder)
                    .build(),
                TranslationQueryTransformer.builder()
                    .chatClientBuilder(chatClientBuilder)
                    .targetLanguage("korean")
                    .build()
            )
            // ë¬¸ì„œ ê²€ìƒ‰
            .documentRetriever(
                VectorStoreDocumentRetriever.builder()
                    .vectorStore(vectorStore)
                    .similarityThreshold(0.7)
                    .topK(8)
                    .build()
            )
            // ë¬¸ì„œ í›„ì²˜ë¦¬
            .documentPostProcessors(
                new RerankingDocumentPostProcessor(),
                new DeduplicationDocumentPostProcessor()
            )
            // ì¿¼ë¦¬ ë³´ê°•
            .queryAugmenter(
                ContextualQueryAugmenter.builder()
                    .allowEmptyContext(false)
                    .build()
            )
            .build();
    }
}

// ì»¤ìŠ¤í…€ ë¬¸ì„œ í›„ì²˜ë¦¬ê¸°
@Component
public class RerankingDocumentPostProcessor implements DocumentPostProcessor {
    
    private final ChatClient rerankClient;
    
    @Override
    public List&lt;Document&gt; process(List&lt;Document&gt; documents, Query query) {
        if (documents.size() &lt;= 3) {
            return documents; // ì¬ìˆœìœ„í™” ë¶ˆí•„ìš”
        }
        
        String rerankPrompt = buildRerankPrompt(documents, query);
        
        List&lt;Integer&gt; rankedIndices = rerankClient.prompt()
            .system("ë¬¸ì„œë“¤ì„ ì§ˆë¬¸ê³¼ì˜ ê´€ë ¨ì„±ì— ë”°ë¼ ìˆœìœ„ë¥¼ ë§¤ê¸°ì„¸ìš”.")
            .user(rerankPrompt)
            .call()
            .entity(new ParameterizedTypeReference&lt;List&lt;Integer&gt;&gt;() {});
        
        return rankedIndices.stream()
            .map(documents::get)
            .toList();
    }
    
    private String buildRerankPrompt(List&lt;Document&gt; documents, Query query) {
        StringBuilder prompt = new StringBuilder();
        prompt.append("ì§ˆë¬¸: ").append(query.getText()).append("\n\n");
        prompt.append("ë¬¸ì„œë“¤:\n");
        
        for (int i = 0; i &lt; documents.size(); i++) {
            prompt.append(i).append(". ")
                  .append(documents.get(i).getContent().substring(0, 200))
                  .append("...\n");
        }
        
        prompt.append("\nê°€ì¥ ê´€ë ¨ì„±ì´ ë†’ì€ ìˆœì„œëŒ€ë¡œ ë¬¸ì„œ ë²ˆí˜¸ë¥¼ JSON ë°°ì—´ë¡œ ë°˜í™˜í•˜ì„¸ìš”.");
        return prompt.toString();
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Custom Advisors -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">ì»¤ìŠ¤í…€ Advisor ê°œë°œ</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">Advisor ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('custom-advisor')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="custom-advisor"><code class="language-java">// ì½˜í…ì¸  í•„í„°ë§ Advisor
@Component
public class ContentFilteringAdvisor implements RequestResponseAdvisor {
    
    private final ProfanityFilter profanityFilter;
    private final ToxicityDetector toxicityDetector;
    
    @Override
    public AdvisedRequest adviseRequest(AdvisedRequest request, Map&lt;String, Object&gt; context) {
        UserMessage userMessage = request.userMessage();
        String content = userMessage.getContent();
        
        // 1. ìš•ì„¤ í•„í„°ë§
        if (profanityFilter.containsProfanity(content)) {
            content = profanityFilter.cleanText(content);
        }
        
        // 2. ë…ì„± ì½˜í…ì¸  ê²€ì‚¬
        ToxicityScore score = toxicityDetector.analyze(content);
        if (score.isHighToxicity()) {
            throw new ContentViolationException("ë¶€ì ì ˆí•œ ì½˜í…ì¸ ê°€ ê°ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }
        
        // 3. ë©”íƒ€ë°ì´í„° ì¶”ê°€
        context.put("original_content", userMessage.getContent());
        context.put("toxicity_score", score.getScore());
        
        UserMessage cleanedMessage = new UserMessage(content, userMessage.getMedia());
        return AdvisedRequest.from(request).withUserMessage(cleanedMessage).build();
    }
    
    @Override
    public ChatResponse adviseResponse(ChatResponse response, Map&lt;String, Object&gt; context) {
        // ì‘ë‹µ í›„ì²˜ë¦¬
        String responseContent = response.getResult().getOutput().getContent();
        
        // ë¯¼ê°í•œ ì •ë³´ ë§ˆìŠ¤í‚¹
        String maskedContent = maskSensitiveInfo(responseContent);
        
        // ì‘ë‹µ í’ˆì§ˆ ê²€ì¦
        QualityScore quality = assessResponseQuality(maskedContent, context);
        
        if (quality.isLowQuality()) {
            // ì €í’ˆì§ˆ ì‘ë‹µ ê°œì„ 
            maskedContent = improveResponse(maskedContent, context);
        }
        
        return ChatResponse.builder()
            .from(response)
            .withContent(maskedContent)
            .withMetadata("quality_score", quality.getScore())
            .build();
    }
    
    @Override
    public int getOrder() {
        return 100; // ë†’ì€ ìš°ì„ ìˆœìœ„
    }
    
    private String maskSensitiveInfo(String content) {
        // ì´ë©”ì¼, ì „í™”ë²ˆí˜¸, ì£¼ë¯¼ë²ˆí˜¸ ë“± ë§ˆìŠ¤í‚¹
        return content
            .replaceAll("\\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Z|a-z]{2,}\\b", "***@***.***")
            .replaceAll("\\b\\d{3}-\\d{4}-\\d{4}\\b", "***-****-****")
            .replaceAll("\\b\\d{6}-\\d{7}\\b", "******-*******");
    }
    
    private String improveResponse(String response, Map&lt;String, Object&gt; context) {
        // AIë¥¼ ì‚¬ìš©í•œ ì‘ë‹µ ê°œì„  ë¡œì§
        return response + "\n\n(ë‹µë³€ì´ ë¶ˆì¶©ë¶„í•œ ê²½ìš° ë” ìì„¸í•œ ì •ë³´ë¥¼ ìš”ì²­í•´ ì£¼ì„¸ìš”.)";
    }
}

// ë¡œê¹… ë° ë¶„ì„ Advisor
@Component
public class AnalyticsAdvisor implements RequestResponseAdvisor {
    
    private final ChatAnalyticsService analyticsService;
    
    @Override
    public AdvisedRequest adviseRequest(AdvisedRequest request, Map&lt;String, Object&gt; context) {
        // ìš”ì²­ ë¡œê¹… ë° ë¶„ì„
        ChatRequest chatRequest = ChatRequest.builder()
            .userId(getCurrentUserId())
            .sessionId(getSessionId(context))
            .userMessage(request.userMessage().getContent())
            .timestamp(Instant.now())
            .build();
        
        analyticsService.logRequest(chatRequest);
        
        // ì»¨í…ìŠ¤íŠ¸ì— ì¶”ì  ì •ë³´ ì €ì¥
        context.put("request_id", chatRequest.getId());
        context.put("start_time", System.currentTimeMillis());
        
        return request;
    }
    
    @Override
    public ChatResponse adviseResponse(ChatResponse response, Map&lt;String, Object&gt; context) {
        // ì‘ë‹µ ë¡œê¹… ë° ë©”íŠ¸ë¦­ ìˆ˜ì§‘
        String requestId = (String) context.get("request_id");
        long startTime = (Long) context.get("start_time");
        long responseTime = System.currentTimeMillis() - startTime;
        
        ChatResponse chatResponse = ChatResponse.builder()
            .requestId(requestId)
            .responseContent(response.getResult().getOutput().getContent())
            .responseTime(responseTime)
            .tokenUsage(response.getMetadata().getUsage())
            .timestamp(Instant.now())
            .build();
        
        analyticsService.logResponse(chatResponse);
        
        // ì„±ëŠ¥ ë©”íŠ¸ë¦­ ê¸°ë¡
        analyticsService.recordMetrics(
            responseTime,
            response.getMetadata().getUsage().getTotalTokens()
        );
        
        return response;
    }
    
    @Override
    public int getOrder() {
        return Integer.MAX_VALUE; // ê°€ì¥ ë‚®ì€ ìš°ì„ ìˆœìœ„ (ë§ˆì§€ë§‰ ì‹¤í–‰)
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Advanced Patterns -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">ê³ ê¸‰ íŒ¨í„´</h2>
                
                <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
                    <h3 class="text-lg font-semibold mb-3">ì¡°ê±´ë¶€ Advisor ì‹¤í–‰</h3>
                    
                    <div class="code-block p-4 relative">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('conditional-advisor')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="conditional-advisor"><code class="language-java">@Component
public class ConditionalRAGAdvisor implements RequestResponseAdvisor {
    
    private final QuestionAnswerAdvisor qaAdvisor;
    private final ChatClient intentClassifier;
    
    @Override
    public AdvisedRequest adviseRequest(AdvisedRequest request, Map&lt;String, Object&gt; context) {
        String userMessage = request.userMessage().getContent();
        
        // ì˜ë„ ë¶„ë¥˜
        QueryIntent intent = classifyIntent(userMessage);
        context.put("query_intent", intent);
        
        // RAGê°€ í•„ìš”í•œ ê²½ìš°ì—ë§Œ ì‹¤í–‰
        if (intent.requiresKnowledgeBase()) {
            return qaAdvisor.adviseRequest(request, context);
        }
        
        return request;
    }
    
    @Override
    public ChatResponse adviseResponse(ChatResponse response, Map&lt;String, Object&gt; context) {
        QueryIntent intent = (QueryIntent) context.get("query_intent");
        
        if (intent.requiresKnowledgeBase()) {
            return qaAdvisor.adviseResponse(response, context);
        }
        
        return response;
    }
    
    private QueryIntent classifyIntent(String message) {
        String classification = intentClassifier.prompt()
            .system("""
                ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ë‹¤ìŒ ì¹´í…Œê³ ë¦¬ë¡œ ë¶„ë¥˜í•˜ì„¸ìš”:
                - KNOWLEDGE_QUERY: ì§€ì‹ë² ì´ìŠ¤ ê²€ìƒ‰ì´ í•„ìš”í•œ ì§ˆë¬¸
                - GENERAL_CHAT: ì¼ë°˜ì ì¸ ëŒ€í™”
                - TASK_REQUEST: íŠ¹ì • ì‘ì—… ìš”ì²­
                
                JSON í˜•ì‹ìœ¼ë¡œ ì‘ë‹µí•˜ì„¸ìš”: {"type": "KNOWLEDGE_QUERY", "confidence": 0.95}
                """)
            .user(message)
            .call()
            .content();
        
        return parseIntentClassification(classification);
    }
}

// ë©€í‹° ì†ŒìŠ¤ RAG Advisor
@Component
public class MultiSourceRAGAdvisor implements RequestResponseAdvisor {
    
    private final Map&lt;String, QuestionAnswerAdvisor&gt; sourceAdvisors;
    private final SourceSelector sourceSelector;
    
    public MultiSourceRAGAdvisor(
            @Qualifier("documentStore") VectorStore documentStore,
            @Qualifier("codeStore") VectorStore codeStore,
            @Qualifier("faqStore") VectorStore faqStore) {
        
        this.sourceAdvisors = Map.of(
            "documents", new QuestionAnswerAdvisor(documentStore),
            "code", new QuestionAnswerAdvisor(codeStore),
            "faq", new QuestionAnswerAdvisor(faqStore)
        );
    }
    
    @Override
    public AdvisedRequest adviseRequest(AdvisedRequest request, Map&lt;String, Object&gt; context) {
        String userMessage = request.userMessage().getContent();
        
        // ìµœì  ì†ŒìŠ¤ ì„ íƒ
        List&lt;String&gt; selectedSources = sourceSelector.selectSources(userMessage);
        context.put("selected_sources", selectedSources);
        
        // ì„ íƒëœ ì†ŒìŠ¤ë“¤ì—ì„œ ê²€ìƒ‰
        List&lt;Document&gt; allDocuments = new ArrayList&lt;&gt;();
        
        for (String source : selectedSources) {
            QuestionAnswerAdvisor advisor = sourceAdvisors.get(source);
            if (advisor != null) {
                AdvisedRequest sourceRequest = advisor.adviseRequest(request, context);
                // ê° ì†ŒìŠ¤ë³„ ê²°ê³¼ë¥¼ ìˆ˜ì§‘
                List&lt;Document&gt; sourceDocuments = extractDocumentsFromContext(context, source);
                allDocuments.addAll(sourceDocuments);
            }
        }
        
        // í†µí•©ëœ ì»¨í…ìŠ¤íŠ¸ ìƒì„±
        String combinedContext = buildCombinedContext(allDocuments);
        context.put("combined_context", combinedContext);
        
        return request;
    }
}</code></pre>
                    </div>
                </div>
            </section>

            <!-- Best Practices -->
            <section class="mb-12">
                <h2 class="text-2xl font-semibold mb-4">ğŸ¯ Best Practices</h2>
                
                <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-lg p-6">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-lg font-semibold mb-4">ì„¤ê³„ ì›ì¹™</h3>
                            <ul class="space-y-2 text-sm">
                                <li>âœ… <strong>ë‹¨ì¼ ì±…ì„</strong>: ê° AdvisorëŠ” í•˜ë‚˜ì˜ ëª…í™•í•œ ëª©ì </li>
                                <li>âœ… <strong>ìˆœì„œ ê³ ë ¤</strong>: getOrder()ë¡œ ì‹¤í–‰ ìˆœì„œ ì œì–´</li>
                                <li>âœ… <strong>ìƒíƒœ ë¹„ì €ì¥</strong>: AdvisorëŠ” statelessí•˜ê²Œ ì„¤ê³„</li>
                                <li>âœ… <strong>ì˜ˆì™¸ ì²˜ë¦¬</strong>: ì‹¤íŒ¨í•´ë„ ì „ì²´ í”Œë¡œìš° ì¤‘ë‹¨ ë°©ì§€</li>
                                <li>âœ… <strong>ì„±ëŠ¥ ìµœì í™”</strong>: ë¶ˆí•„ìš”í•œ ì—°ì‚° ìµœì†Œí™”</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold mb-4">êµ¬í˜„ íŒ</h3>
                            <ul class="space-y-2 text-sm">
                                <li>âœ… <strong>ì»¨í…ìŠ¤íŠ¸ í™œìš©</strong>: Advisor ê°„ ë°ì´í„° ê³µìœ </li>
                                <li>âœ… <strong>ì¡°ê±´ë¶€ ì‹¤í–‰</strong>: í•„ìš”ì‹œì—ë§Œ Advisor ë™ì‘</li>
                                <li>âœ… <strong>ë¡œê¹…</strong>: ë””ë²„ê¹…ì„ ìœ„í•œ ìƒì„¸ ë¡œê·¸</li>
                                <li>âœ… <strong>í…ŒìŠ¤íŠ¸</strong>: ê° Advisor ë‹¨ìœ„ í…ŒìŠ¤íŠ¸</li>
                                <li>âœ… <strong>ëª¨ë‹ˆí„°ë§</strong>: ì„±ëŠ¥ ë° ì˜¤ë¥˜ ì¶”ì </li>
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-yellow-100 p-4 rounded-lg">
                        <h4 class="font-semibold mb-2">âš ï¸ ì£¼ì˜ì‚¬í•­</h4>
                        <ul class="space-y-1 text-sm">
                            <li>â€¢ Advisor ì²´ì¸ì´ ë„ˆë¬´ ê¸¸ë©´ ì‘ë‹µ ì§€ì—° ë°œìƒ</li>
                            <li>â€¢ ì»¨í…ìŠ¤íŠ¸ í¬ê¸° ê´€ë¦¬ (ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰)</li>
                            <li>â€¢ ìˆœí™˜ ì˜ì¡´ì„± ë°©ì§€</li>
                            <li>â€¢ ì˜ˆì™¸ ë°œìƒ ì‹œ graceful degradation</li>
                        </ul>
                    </div>
                </div>
            </section>

            <!-- Navigation -->
            <section class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-xl font-semibold mb-4">ê´€ë ¨ ê°€ì´ë“œ</h2>
                
                <div class="grid md:grid-cols-3 gap-4">
                    <a href="rag.html" class="block p-4 border rounded-lg hover:bg-gray-50 transition">
                        <h3 class="font-semibold text-blue-600 mb-2">RAG ì‹œìŠ¤í…œ</h3>
                        <p class="text-sm text-gray-600">RAG êµ¬í˜„ ìƒì„¸ ê°€ì´ë“œ</p>
                    </a>
                    
                    <a href="vectorstore.html" class="block p-4 border rounded-lg hover:bg-gray-50 transition">
                        <h3 class="font-semibold text-green-600 mb-2">VectorStore</h3>
                        <p class="text-sm text-gray-600">ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •</p>
                    </a>
                    
                    <a href="tools.html" class="block p-4 border rounded-lg hover:bg-gray-50 transition">
                        <h3 class="font-semibold text-purple-600 mb-2">Tool Calling</h3>
                        <p class="text-sm text-gray-600">í•¨ìˆ˜ í˜¸ì¶œ ê¸°ëŠ¥</p>
                    </a>
                </div>
            </section>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
        function copyCode(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showNotification('ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg z-50';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 2000);
        }
    </script>
</body>
</html>