<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spring AI ì½”ë“œ í…œí”Œë¦¿ ëª¨ìŒ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .code-block { background: #2d3748; border-radius: 8px; }
        .copy-button { transition: all 0.2s ease; }
        .copy-button:hover { background-color: #4a5568; }
        .template-card { transition: transform 0.2s ease; }
        .template-card:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white shadow-sm">
        <div class="container mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center">
                    <a href="../index.html" class="flex items-center text-xl font-bold text-gray-800">
                        <i class="fab fa-spring text-green-600 mr-2"></i>
                        Spring AI Hub
                    </a>
                    <span class="mx-3 text-gray-400">/</span>
                    <span class="text-gray-600">ì½”ë“œ í…œí”Œë¦¿</span>
                </div>
                <a href="../index.html" class="text-blue-600 hover:text-blue-800">
                    <i class="fas fa-home"></i> í™ˆìœ¼ë¡œ
                </a>
            </div>
        </div>
    </header>

    <div class="container mx-auto px-4 py-8">
        <div class="max-w-6xl mx-auto">
            <h1 class="text-4xl font-bold mb-4">ğŸ“ ì½”ë“œ í…œí”Œë¦¿ ëª¨ìŒ</h1>
            <p class="text-gray-600 mb-8">ì¦‰ì‹œ ì‚¬ìš© ê°€ëŠ¥í•œ ê²€ì¦ëœ Spring AI ì½”ë“œ í…œí”Œë¦¿</p>

            <!-- Template Categories -->
            <div class="flex flex-wrap gap-4 mb-8">
                <button class="template-filter active bg-blue-600 text-white px-4 py-2 rounded-lg" data-category="all">
                    ì „ì²´
                </button>
                <button class="template-filter bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300" data-category="basic">
                    ê¸°ë³¸ ì„¤ì •
                </button>
                <button class="template-filter bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300" data-category="rag">
                    RAG ì‹œìŠ¤í…œ
                </button>
                <button class="template-filter bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300" data-category="tools">
                    Tool Calling
                </button>
                <button class="template-filter bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300" data-category="agents">
                    ì—ì´ì „íŠ¸
                </button>
                <button class="template-filter bg-gray-200 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-300" data-category="monitoring">
                    ëª¨ë‹ˆí„°ë§
                </button>
            </div>

            <!-- Template Grid -->
            <div class="space-y-8">
                
                <!-- Basic ChatClient -->
                <div class="template-card bg-white rounded-lg shadow-lg p-6" data-category="basic">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold flex items-center">
                            <i class="fas fa-comments text-blue-500 mr-3"></i>
                            ê¸°ë³¸ ChatClient
                        </h3>
                        <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded text-sm">ê¸°ë³¸</span>
                    </div>
                    <p class="text-gray-600 mb-4">ê°€ì¥ ê¸°ë³¸ì ì¸ ChatClient ì„¤ì •ê³¼ ì‚¬ìš©ë²•</p>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('basic-chatclient')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="basic-chatclient"><code class="language-java">@Service
public class BasicChatService {
    
    private final ChatClient chatClient;
    
    public BasicChatService(ChatClient.Builder builder) {
        this.chatClient = builder
            .defaultOptions(OpenAiChatOptions.builder()
                .withModel(OpenAiApi.ChatModel.GPT_4_O)
                .withTemperature(0.7f)
                .build())
            .build();
    }
    
    public String chat(String message) {
        return chatClient.prompt()
            .user(message)
            .call()
            .content();
    }
    
    public Flux&lt;String&gt; chatStream(String message) {
        return chatClient.prompt()
            .user(message)
            .stream()
            .content();
    }
}</code></pre>
                    </div>
                    <div class="text-sm text-gray-500">
                        âœ… ë™ê¸°/ë¹„ë™ê¸° ì§€ì› âœ… ì„¤ì • ê°„ë‹¨ âœ… í”„ë¡œë•ì…˜ ì¤€ë¹„
                    </div>
                </div>

                <!-- RAG System -->
                <div class="template-card bg-white rounded-lg shadow-lg p-6" data-category="rag">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold flex items-center">
                            <i class="fas fa-search text-green-500 mr-3"></i>
                            ì™„ì „í•œ RAG ì‹œìŠ¤í…œ
                        </h3>
                        <span class="bg-green-100 text-green-700 px-2 py-1 rounded text-sm">RAG</span>
                    </div>
                    <p class="text-gray-600 mb-4">ë¬¸ì„œ ì„ë² ë”©ë¶€í„° ê²€ìƒ‰ê¹Œì§€ ì™„ì „í•œ RAG êµ¬í˜„</p>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('complete-rag')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="complete-rag"><code class="language-java">@Service
public class RAGService {
    
    private final ChatClient chatClient;
    private final VectorStore vectorStore;
    private final DocumentReader documentReader;
    
    // ë¬¸ì„œ ì„ë² ë”© ë° ì €ì¥
    public void ingestDocuments(Resource[] documents) {
        List&lt;Document&gt; docs = Arrays.stream(documents)
            .flatMap(resource -&gt; documentReader.read(resource).stream())
            .map(document -&gt; {
                document.getMetadata().put("source", resource.getFilename());
                return document;
            })
            .toList();
        
        vectorStore.add(docs);
    }
    
    // RAG ê¸°ë°˜ ì§ˆë¬¸ ë‹µë³€
    public String askQuestion(String question) {
        List&lt;Document&gt; relevantDocs = vectorStore
            .similaritySearch(SearchRequest.query(question).withTopK(5));
        
        String context = relevantDocs.stream()
            .map(Document::getContent)
            .collect(Collectors.joining("\n\n"));
        
        return chatClient.prompt()
            .system("ë‹¤ìŒ ë¬¸ì„œë“¤ì„ ì°¸ê³ í•˜ì—¬ ì§ˆë¬¸ì— ë‹µë³€í•˜ì„¸ìš”:\n{context}")
            .user(question)
            .param("context", context)
            .call()
            .content();
    }
    
    // í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (í‚¤ì›Œë“œ + ë²¡í„°)
    public String hybridSearch(String query) {
        // ë²¡í„° ê²€ìƒ‰
        List&lt;Document&gt; vectorResults = vectorStore
            .similaritySearch(SearchRequest.query(query).withTopK(3));
        
        // í‚¤ì›Œë“œ ê²€ìƒ‰ (ë©”íƒ€ë°ì´í„° ê¸°ë°˜)
        List&lt;Document&gt; keywordResults = vectorStore
            .similaritySearch(SearchRequest.query(query)
                .withFilterExpression("source LIKE '" + extractKeywords(query) + "'")
                .withTopK(2));
        
        List&lt;Document&gt; allResults = new ArrayList&lt;&gt;(vectorResults);
        allResults.addAll(keywordResults);
        
        String context = allResults.stream()
            .distinct()
            .map(Document::getContent)
            .collect(Collectors.joining("\n\n"));
        
        return chatClient.prompt()
            .system("ê²€ìƒ‰ëœ ë¬¸ì„œë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€í•˜ì„¸ìš”:\n{context}")
            .user(query)
            .param("context", context)
            .call()
            .content();
    }
}</code></pre>
                    </div>
                    <div class="text-sm text-gray-500">
                        âœ… ë¬¸ì„œ ì„ë² ë”© âœ… í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ âœ… ë©”íƒ€ë°ì´í„° í™œìš©
                    </div>
                </div>

                <!-- Tool Calling -->
                <div class="template-card bg-white rounded-lg shadow-lg p-6" data-category="tools">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold flex items-center">
                            <i class="fas fa-tools text-purple-500 mr-3"></i>
                            ê³ ê¸‰ Tool Calling
                        </h3>
                        <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded text-sm">ë„êµ¬</span>
                    </div>
                    <p class="text-gray-600 mb-4">ì‹¤ì œ ì„œë¹„ìŠ¤ì™€ ì—°ë™í•˜ëŠ” Tool Calling êµ¬í˜„</p>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('advanced-tools')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="advanced-tools"><code class="language-java">@Component
public class BusinessTools {
    
    private final WeatherService weatherService;
    private final DatabaseService databaseService;
    
    @Tool("í˜„ì¬ ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤")
    public WeatherInfo getCurrentWeather(
        @ToolParam("ë„ì‹œëª…") String city,
        @ToolParam("ë‹¨ìœ„ (celsius/fahrenheit)") String unit) {
        
        return weatherService.getWeather(city, unit);
    }
    
    @Tool("ê³ ê° ì •ë³´ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤")
    public CustomerInfo getCustomerInfo(
        @ToolParam("ê³ ê° ID") String customerId) {
        
        return databaseService.findCustomerById(customerId);
    }
    
    @Tool("ì£¼ë¬¸ ìƒíƒœë¥¼ í™•ì¸í•©ë‹ˆë‹¤")
    public OrderStatus checkOrderStatus(
        @ToolParam("ì£¼ë¬¸ ë²ˆí˜¸") String orderNumber) {
        
        return databaseService.getOrderStatus(orderNumber);
    }
    
    @Tool("ì´ë©”ì¼ì„ ë°œì†¡í•©ë‹ˆë‹¤")
    public EmailResult sendEmail(
        @ToolParam("ë°›ëŠ” ì‚¬ëŒ") String recipient,
        @ToolParam("ì œëª©") String subject,
        @ToolParam("ë‚´ìš©") String content) {
        
        // ì´ë©”ì¼ ë°œì†¡ ë¡œì§
        emailService.send(recipient, subject, content);
        return new EmailResult(true, "ì´ë©”ì¼ì´ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
    }
}

@Service
public class ToolCallingService {
    
    private final ChatClient chatClient;
    
    public ToolCallingService(ChatClient.Builder builder) {
        this.chatClient = builder
            .defaultFunctions(
                "getCurrentWeather",
                "getCustomerInfo", 
                "checkOrderStatus",
                "sendEmail"
            )
            .build();
    }
    
    public String processRequest(String userMessage) {
        return chatClient.prompt()
            .user(userMessage)
            .call()
            .content();
    }
}</code></pre>
                    </div>
                    <div class="text-sm text-gray-500">
                        âœ… ì‹¤ì œ ì„œë¹„ìŠ¤ ì—°ë™ âœ… ë³µí•© ë„êµ¬ í˜¸ì¶œ âœ… ì—ëŸ¬ ì²˜ë¦¬
                    </div>
                </div>

                <!-- Multi-Agent System -->
                <div class="template-card bg-white rounded-lg shadow-lg p-6" data-category="agents">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold flex items-center">
                            <i class="fas fa-robot text-red-500 mr-3"></i>
                            ë©€í‹° ì—ì´ì „íŠ¸ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´í„°
                        </h3>
                        <span class="bg-red-100 text-red-700 px-2 py-1 rounded text-sm">ì—ì´ì „íŠ¸</span>
                    </div>
                    <p class="text-gray-600 mb-4">ë³µì¡í•œ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ì—ì´ì „íŠ¸ ì‹œìŠ¤í…œ</p>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('multi-agent')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="multi-agent"><code class="language-java">@Service
public class MultiAgentOrchestrator {
    
    private final Map&lt;String, Agent&gt; agents;
    private final TaskRouter taskRouter;
    
    public MultiAgentOrchestrator() {
        this.agents = Map.of(
            "research", new ResearchAgent(),
            "analysis", new AnalysisAgent(),
            "writing", new WritingAgent(),
            "review", new ReviewAgent()
        );
        this.taskRouter = new TaskRouter();
    }
    
    // ìˆœì°¨ ì²˜ë¦¬ (Chain Workflow)
    public AgentResponse processChain(TaskRequest request) {
        var research = agents.get("research").execute(request);
        var analysis = agents.get("analysis").execute(research.toRequest());
        var writing = agents.get("writing").execute(analysis.toRequest());
        return agents.get("review").execute(writing.toRequest());
    }
    
    // ë³‘ë ¬ ì²˜ë¦¬ (Parallel Workflow)
    public AgentResponse processParallel(TaskRequest request) {
        CompletableFuture&lt;AgentResponse&gt; researchTask = 
            CompletableFuture.supplyAsync(() -&gt; 
                agents.get("research").execute(request));
        
        CompletableFuture&lt;AgentResponse&gt; analysisTask = 
            CompletableFuture.supplyAsync(() -&gt; 
                agents.get("analysis").execute(request));
        
        // ë³‘ë ¬ ê²°ê³¼ ìˆ˜ì§‘
        List&lt;AgentResponse&gt; results = CompletableFuture.allOf(
            researchTask, analysisTask
        ).thenApply(v -&gt; List.of(
            researchTask.join(), 
            analysisTask.join()
        )).join();
        
        // ê²°ê³¼ ì¢…í•©
        TaskRequest synthesisRequest = TaskRequest.builder()
            .content("ë‹¤ìŒ ê²°ê³¼ë“¤ì„ ì¢…í•©í•˜ì—¬ ë‹µë³€í•˜ì„¸ìš”:")
            .context(results)
            .build();
        
        return agents.get("writing").execute(synthesisRequest);
    }
    
    // ì§€ëŠ¥í˜• ë¼ìš°íŒ… (Routing Workflow)
    public AgentResponse processWithRouting(TaskRequest request) {
        String selectedAgent = taskRouter.route(request);
        Agent agent = agents.get(selectedAgent);
        
        AgentResponse response = agent.execute(request);
        
        // í’ˆì§ˆ ê²€ì¦
        if (response.getQualityScore() &lt; 0.7) {
            // ë‹¤ë¥¸ ì—ì´ì „íŠ¸ë¡œ ì¬ì‹œë„
            String fallbackAgent = taskRouter.getFallback(selectedAgent);
            response = agents.get(fallbackAgent).execute(request);
        }
        
        return response;
    }
}

// ê¸°ë³¸ ì—ì´ì „íŠ¸ ì¸í„°í˜ì´ìŠ¤
public interface Agent {
    AgentResponse execute(TaskRequest request);
    String getName();
    double getConfidenceThreshold();
}

// ì—°êµ¬ ì „ë¬¸ ì—ì´ì „íŠ¸
@Component
public class ResearchAgent implements Agent {
    
    private final ChatClient chatClient;
    private final VectorStore vectorStore;
    
    @Override
    public AgentResponse execute(TaskRequest request) {
        // ê´€ë ¨ ë¬¸ì„œ ê²€ìƒ‰
        List&lt;Document&gt; docs = vectorStore.similaritySearch(request.getContent());
        
        String response = chatClient.prompt()
            .system("ë‹¹ì‹ ì€ ì—°êµ¬ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì£¼ì–´ì§„ ë¬¸ì„œë¥¼ ë°”íƒ•ìœ¼ë¡œ ì² ì €í•œ ì¡°ì‚¬ë¥¼ ìˆ˜í–‰í•˜ì„¸ìš”.")
            .user(request.getContent())
            .param("documents", docs)
            .call()
            .content();
        
        return AgentResponse.builder()
            .content(response)
            .agentName("research")
            .qualityScore(calculateQualityScore(response))
            .build();
    }
}</code></pre>
                    </div>
                    <div class="text-sm text-gray-500">
                        âœ… ì›Œí¬í”Œë¡œìš° íŒ¨í„´ âœ… ì§€ëŠ¥í˜• ë¼ìš°íŒ… âœ… í’ˆì§ˆ ê²€ì¦
                    </div>
                </div>

                <!-- Monitoring Template -->
                <div class="template-card bg-white rounded-lg shadow-lg p-6" data-category="monitoring">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold flex items-center">
                            <i class="fas fa-chart-line text-orange-500 mr-3"></i>
                            ëª¨ë‹ˆí„°ë§ ë° ë©”íŠ¸ë¦­
                        </h3>
                        <span class="bg-orange-100 text-orange-700 px-2 py-1 rounded text-sm">ëª¨ë‹ˆí„°ë§</span>
                    </div>
                    <p class="text-gray-600 mb-4">í”„ë¡œë•ì…˜ í™˜ê²½ì„ ìœ„í•œ í¬ê´„ì ì¸ ëª¨ë‹ˆí„°ë§</p>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('monitoring-setup')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="monitoring-setup"><code class="language-java">@Component
public class AIMetricsCollector {
    
    private final MeterRegistry meterRegistry;
    private final Counter requestCounter;
    private final Timer responseTimer;
    private final Gauge tokenUsageGauge;
    
    public AIMetricsCollector(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
        this.requestCounter = Counter.builder("ai.requests.total")
            .description("Total AI requests")
            .register(meterRegistry);
        this.responseTimer = Timer.builder("ai.response.duration")
            .description("AI response time")
            .register(meterRegistry);
        this.tokenUsageGauge = Gauge.builder("ai.tokens.used")
            .description("Tokens used")
            .register(meterRegistry, this, AIMetricsCollector::getTokenUsage);
    }
    
    @EventListener
    public void handleChatEvent(ChatModelObservationEvent event) {
        requestCounter.increment(
            Tags.of(
                "model", event.getModel(),
                "provider", event.getProvider(),
                "status", event.isSuccess() ? "success" : "error"
            )
        );
        
        if (event.getResponseTime() != null) {
            responseTimer.record(event.getResponseTime(), TimeUnit.MILLISECONDS);
        }
        
        if (event.getTokenUsage() != null) {
            recordTokenUsage(event.getTokenUsage());
        }
    }
    
    private void recordTokenUsage(Usage tokenUsage) {
        Gauge.builder("ai.tokens.input")
            .description("Input tokens used")
            .register(meterRegistry, tokenUsage, Usage::getInputTokens);
        
        Gauge.builder("ai.tokens.output")
            .description("Output tokens used")
            .register(meterRegistry, tokenUsage, Usage::getOutputTokens);
    }
}

@Component
public class AlertManager {
    
    private final NotificationService notificationService;
    private final MeterRegistry meterRegistry;
    
    @Scheduled(fixedRate = 60000) // 1ë¶„ë§ˆë‹¤ ì²´í¬
    public void checkAlerts() {
        checkErrorRate();
        checkResponseTime();
        checkTokenUsage();
        checkCostThreshold();
    }
    
    private void checkErrorRate() {
        double errorRate = calculateErrorRate();
        if (errorRate > 0.05) { // 5% ì´ˆê³¼
            sendAlert("High Error Rate", 
                String.format("Error rate: %.2f%%", errorRate * 100));
        }
    }
    
    private void checkResponseTime() {
        Timer timer = meterRegistry.timer("ai.response.duration");
        double p95 = timer.takeSnapshot().percentileValue(0.95);
        
        if (p95 > 10000) { // 10ì´ˆ ì´ˆê³¼
            sendAlert("Slow Response Time", 
                String.format("P95 response time: %.2fs", p95 / 1000));
        }
    }
    
    private void sendAlert(String title, String message) {
        notificationService.send(Alert.builder()
            .title(title)
            .message(message)
            .timestamp(LocalDateTime.now())
            .severity(AlertSeverity.WARNING)
            .build());
    }
}</code></pre>
                    </div>
                    <div class="text-sm text-gray-500">
                        âœ… ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ âœ… ìë™ ì•Œë¦¼ âœ… ì„±ëŠ¥ ì¶”ì 
                    </div>
                </div>

                <!-- Streaming Response -->
                <div class="template-card bg-white rounded-lg shadow-lg p-6" data-category="basic">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold flex items-center">
                            <i class="fas fa-stream text-indigo-500 mr-3"></i>
                            ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ
                        </h3>
                        <span class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-sm">ìŠ¤íŠ¸ë¦¬ë°</span>
                    </div>
                    <p class="text-gray-600 mb-4">Server-Sent Eventsë¥¼ í™œìš©í•œ ì‹¤ì‹œê°„ ì‘ë‹µ</p>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('streaming-response')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="streaming-response"><code class="language-java">@RestController
@RequestMapping("/api/stream")
public class StreamingChatController {
    
    private final ChatClient chatClient;
    
    @PostMapping(value = "/chat", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
    public Flux&lt;ServerSentEvent&lt;String&gt;&gt; streamChat(@RequestBody ChatRequest request) {
        
        return chatClient.prompt()
            .user(request.getMessage())
            .stream()
            .content()
            .map(content -&gt; ServerSentEvent.&lt;String&gt;builder()
                .data(content)
                .event("message")
                .build())
            .concatWith(Mono.just(ServerSentEvent.&lt;String&gt;builder()
                .event("end")
                .data("[DONE]")
                .build()));
    }
    
    @PostMapping(value = "/chat-with-metadata", produces = MediaType.TEXT_EVENT_STREAM_VALUE)
    public Flux&lt;ServerSentEvent&lt;Object&gt;&gt; streamChatWithMetadata(@RequestBody ChatRequest request) {
        
        return chatClient.prompt()
            .user(request.getMessage())
            .stream()
            .chatResponse()
            .map(response -&gt; {
                StreamResponse streamResponse = StreamResponse.builder()
                    .content(response.getResult().getOutput().getText())
                    .tokenUsage(response.getMetadata().getUsage())
                    .finishReason(response.getResult().getMetadata().getFinishReason())
                    .build();
                
                return ServerSentEvent.&lt;Object&gt;builder()
                    .data(streamResponse)
                    .event("message")
                    .build();
            })
            .concatWith(Mono.just(ServerSentEvent.&lt;Object&gt;builder()
                .event("end")
                .data(Map.of("status", "completed"))
                .build()));
    }
    
    @Data
    @Builder
    public static class StreamResponse {
        private String content;
        private Usage tokenUsage;
        private String finishReason;
    }
}

// í´ë¼ì´ì–¸íŠ¸ ì¸¡ JavaScript ì˜ˆì œ
/*
const eventSource = new EventSource('/api/stream/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ message: 'ì•ˆë…•í•˜ì„¸ìš”!' })
});

eventSource.addEventListener('message', (event) =&gt; {
    const data = event.data;
    document.getElementById('response').innerHTML += data;
});

eventSource.addEventListener('end', () =&gt; {
    eventSource.close();
    console.log('Stream completed');
});
*/</code></pre>
                    </div>
                    <div class="text-sm text-gray-500">
                        âœ… ì‹¤ì‹œê°„ UI ì—…ë°ì´íŠ¸ âœ… ë©”íƒ€ë°ì´í„° í¬í•¨ âœ… í´ë¼ì´ì–¸íŠ¸ ì˜ˆì œ
                    </div>
                </div>

                <!-- Vector Store Configuration -->
                <div class="template-card bg-white rounded-lg shadow-lg p-6" data-category="rag">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-semibold flex items-center">
                            <i class="fas fa-database text-teal-500 mr-3"></i>
                            ë²¡í„° ìŠ¤í† ì–´ ì„¤ì • ëª¨ìŒ
                        </h3>
                        <span class="bg-teal-100 text-teal-700 px-2 py-1 rounded text-sm">ë²¡í„°DB</span>
                    </div>
                    <p class="text-gray-600 mb-4">ì£¼ìš” ë²¡í„° ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ë° ì‚¬ìš©ë²•</p>
                    
                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('vector-configs')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="vector-configs"><code class="language-yaml"># === ë¡œì»¬ ê°œë°œ: Chroma ===
spring:
  ai:
    vectorstore:
      chroma:
        host: localhost
        port: 8000

---
# === í”„ë¡œë•ì…˜: PostgreSQL + pgvector ===
spring:
  ai:
    vectorstore:
      pgvector:
        url: jdbc:postgresql://localhost:5432/vectordb
        username: ${DB_USERNAME}
        password: ${DB_PASSWORD}
        schema-name: public
        table-name: vector_store
        distance-type: COSINE_DISTANCE

---
# === í´ë¼ìš°ë“œ: Pinecone ===
spring:
  ai:
    vectorstore:
      pinecone:
        api-key: ${PINECONE_API_KEY}
        environment: ${PINECONE_ENV}
        project-id: ${PINECONE_PROJECT_ID}
        index-name: spring-ai-index

---
# === ì˜¤í”ˆì†ŒìŠ¤: Qdrant ===
spring:
  ai:
    vectorstore:
      qdrant:
        host: localhost
        port: 6334
        collection-name: documents
        use-tls: false</code></pre>
                    </div>

                    <div class="code-block p-4 relative mb-4">
                        <button class="copy-button absolute top-2 right-2 bg-gray-600 text-white px-2 py-1 rounded text-xs" 
                                onclick="copyCode('vector-service')">
                            <i class="fas fa-copy"></i> ë³µì‚¬
                        </button>
                        <pre id="vector-service"><code class="language-java">@Service
public class VectorStoreService {
    
    private final VectorStore vectorStore;
    private final EmbeddingModel embeddingModel;
    
    // ë¬¸ì„œ ì¶”ê°€ (ë°°ì¹˜ ì²˜ë¦¬)
    public void addDocuments(List&lt;Document&gt; documents) {
        // ë©”íƒ€ë°ì´í„° ë³´ê°•
        documents.forEach(doc -&gt; {
            doc.getMetadata().put("timestamp", Instant.now().toString());
            doc.getMetadata().put("source", "api");
        });
        
        vectorStore.add(documents);
    }
    
    // ìœ ì‚¬ë„ ê²€ìƒ‰ (ê¸°ë³¸)
    public List&lt;Document&gt; search(String query, int topK) {
        return vectorStore.similaritySearch(
            SearchRequest.query(query).withTopK(topK)
        );
    }
    
    // í•„í„°ë§ ê²€ìƒ‰
    public List&lt;Document&gt; searchWithFilter(String query, String source, int topK) {
        FilterExpressionBuilder filterBuilder = new FilterExpressionBuilder();
        Expression filter = filterBuilder.eq("source", source).build();
        
        return vectorStore.similaritySearch(
            SearchRequest.query(query)
                .withTopK(topK)
                .withFilterExpression(filter)
        );
    }
    
    // ì„ê³„ê°’ ê¸°ë°˜ ê²€ìƒ‰
    public List&lt;Document&gt; searchWithThreshold(String query, double threshold) {
        return vectorStore.similaritySearch(
            SearchRequest.query(query)
                .withTopK(20)
                .withSimilarityThreshold(threshold)
        );
    }
    
    // ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸
    public void updateDocumentMetadata(String documentId, Map&lt;String, Object&gt; metadata) {
        // ê¸°ì¡´ ë¬¸ì„œ ì¡°íšŒ
        List&lt;Document&gt; docs = vectorStore.similaritySearch(
            SearchRequest.query("").withFilterExpression(
                new FilterExpressionBuilder().eq("id", documentId).build()
            )
        );
        
        if (!docs.isEmpty()) {
            Document doc = docs.get(0);
            doc.getMetadata().putAll(metadata);
            
            // ì‚­ì œ í›„ ì¬ì¶”ê°€ (ì¼ë¶€ ë²¡í„° ìŠ¤í† ì–´ëŠ” ì—…ë°ì´íŠ¸ ë¯¸ì§€ì›)
            vectorStore.delete(List.of(documentId));
            vectorStore.add(List.of(doc));
        }
    }
}</code></pre>
                    </div>
                    <div class="text-sm text-gray-500">
                        âœ… ë‹¤ì¤‘ ë²¡í„°DB ì§€ì› âœ… ë©”íƒ€ë°ì´í„° í™œìš© âœ… ê³ ê¸‰ ê²€ìƒ‰
                    </div>
                </div>

            </div>

            <!-- Download All Templates -->
            <div class="text-center mt-12">
                <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg p-8 text-white">
                    <h3 class="text-2xl font-bold mb-4">ëª¨ë“  í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ</h3>
                    <p class="mb-6">ZIP íŒŒì¼ë¡œ ëª¨ë“  ì½”ë“œ í…œí”Œë¦¿ì„ í•œ ë²ˆì— ë°›ì•„ë³´ì„¸ìš”</p>
                    <button class="bg-white text-blue-600 px-8 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors">
                        <i class="fas fa-download mr-2"></i>
                        ì „ì²´ í…œí”Œë¦¿ ë‹¤ìš´ë¡œë“œ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <script>
        function copyCode(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showNotification('ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 right-4 bg-green-600 text-white px-4 py-2 rounded-lg z-50';
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 2000);
        }

        // Template filtering
        document.querySelectorAll('.template-filter').forEach(button => {
            button.addEventListener('click', function() {
                // Update active button
                document.querySelectorAll('.template-filter').forEach(b => {
                    b.classList.remove('active', 'bg-blue-600', 'text-white');
                    b.classList.add('bg-gray-200', 'text-gray-700');
                });
                this.classList.add('active', 'bg-blue-600', 'text-white');
                this.classList.remove('bg-gray-200', 'text-gray-700');

                // Filter templates
                const category = this.dataset.category;
                document.querySelectorAll('.template-card').forEach(card => {
                    if (category === 'all' || card.dataset.category === category) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
        });
    </script>
</body>
</html>